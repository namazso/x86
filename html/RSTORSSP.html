<!DOCTYPE html> <html lang="en">  <head>     <meta charset="utf-8">     <title>RSTORSSP</title>     <link rel="stylesheet" href="styles.css">     <link rel="stylesheet" href="../intel.css"> </head>  <body>     <svg xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape" version="1.1" width="512.94006pt" height="647.29041pt" viewBox="0 0 512.94006 647.29041" sodipodi:docname="1305.svg" inkscape:version="0.92.5 (2060ec1f9f, 2020-04-08)"><metadata><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage" /></cc:Work></rdf:RDF></metadata><defs /><sodipodi:namedview pagecolor="#ffffff" bordercolor="#666666" borderopacity="1" objecttolerance="10" gridtolerance="10" guidetolerance="10" inkscape:pageopacity="0" inkscape:pageshadow="2" inkscape:window-width="640" inkscape:window-height="480" showgrid="false" inkscape:zoom="0.22348485" inkscape:cx="346.96" inkscape:cy="426.89758" inkscape:window-x="0" inkscape:window-y="0" inkscape:window-maximized="0" inkscape:current-layer="svg174" /><g transform="translate(-45.78,-68.882812)" class="c9D877B2B"><text xml:space="preserve" transform="translate(0,792)" font-size="12" class="cA49CCA52 cD0BE81C2 c209E837B"><tspan y="-714" x="46.02 53.517601 60.176399 66.713997 74.692795 82.190399 88.867203 95.544006 102.8568 112.61761 120.05521 126.76801 132.3468 137.028 143.7468 147.88919 154.60799 157.60799 164.28479 170.67358 177.03479 183.75359 190.49039 193.49039 200.16719 207.04799 213.43678 220.17358 226.71239 236.49239 239.49239 245.79118 250.59239 256.9812 262.5 268.9248 271.9248 279.12601 285.84482 288.83762 295.49521 300.276 306.9888">RSTORSSPâ€”Restore Saved Shadow Stack Pointer</tspan></text><text xml:space="preserve" transform="translate(0,792)" font-size="9.96" class="cC28FA1AE cD0BE81C2 c209E837B"><tspan y="-592.32001" x="235.67999 238.36819 244.06631 248.74551 252.76637 256.3689 262.12677 266.69742 270.65851 273.1774 278.78387 284.52979 287.04968 293.6492 299.28955 304.89603 308.3183 313.65585 319.40176 324.98135 327.50125 333.0679 338.76599 343.20517 348.78476 354.41116 356.93005 362.62814">Instruction Operand Encoding</tspan><tspan y="-535.31995" x="46.019684 52.490696 58.085228 62.853081 67.411774 71.054146 73.561081 79.021156 82.982254 85.489189 91.083725">Description</tspan></text><text xml:space="preserve" transform="translate(0,792)" font-size="9" class="c9256B18F cECB6486A"><tspan y="-519.96002" x="46.02 52.017601 57.420303 62.104805 65.646309 71.104813 74.943314 80.302811 84.987312 87.811508 93.874802 99.998398 105.4209 108.24509 111.40859 115.24709 120.7056 129.4581 132.222 135.7635 141.45601 146.81551 149.63971 154.3242 160.01671 165.4212 171.0237 176.42459 183.74159 187.82309 192.50758 196.04909 201.45358 206.13808 210.99988 215.08138 218.91988 224.27937 228.96387 232.50537 237.96387 241.80237 247.16187 249.98607 253.52757 258.98608 264.20786 269.61057 275.30307 278.06699 283.66949 289.12799 291.52469 297.2262 300.7677 306.1272 311.72971 314.51968 318.05579 323.50888 326.2728 331.8699 337.18799 340.01221 348.75931 354.47342 360.18753 363.45364 366.27786 370.05698 373.21509 376.03931 379.57541 385.26251 390.61661 393.44083 399.50412 405.68802 411.10513 413.92935 417.76245 423.11655 427.79565 431.33176 436.78485 440.61795 445.97205 448.79626 456.05298 461.45657 466.13568 468.9599 473.63901 479.32611 484.00522 488.68433 494.03842 498.71753 503.39664 506.55475 512.24182 514.69794 517.46179 521.06177 526.70386 532.10657 537.74866 540.57281 544.10889 549.79596 555.15009">Restores SSP from the shadow-stack-restore token pointed to by m64. If the SSP restore was successful then the </tspan><tspan y="-508.98001" x="46.019989 48.481491 54.123592 58.808094 62.349594 66.188095 71.880592 76.565094 80.106598 82.5681 88.026604 93.719101 96.543297 100.3818 105.74129 111.3438 113.8053 119.2098 123.8943 129.2538 133.93829 136.7625 140.304 145.99651 151.356 154.18021 158.8647 164.55721 169.9617 175.56419 181.02269 188.27939 192.36089 197.04538 200.58688 205.99138 210.67587 215.59798 219.67947 223.51797 228.87747 233.56197 237.10347 242.56197 246.40047 251.75996 254.58417 258.12567 263.58417 268.80594 274.14835 279.84085 282.66507 290.02258 292.41928 295.96078 301.65329 304.47751 309.88202 312.70624 318.30875 322.14725 327.50674 332.83023 335.29172 340.75021 346.3923 351.1326 355.21411 359.89862 364.58313 370.18564 373.00986 376.55136 382.00986 387.23163 392.57404 398.26654 401.53806 404.36227 409.90176 415.54385 420.94656 423.71048 426.17197 431.86447 436.54898 440.09048 443.92899 449.62149 454.306 457.8475 460.30899 465.76749 471.40958 474.2338 478.9183 484.32101 487.86252 492.54703 495.31094 498.85245 504.54495 509.94766 512.71155 518.98907 524.15955 526.98376 530.14728 532.54309 537.94757 543.55005 546.31396 549.91394 555.31482">instruction replaces the shadow-stack-restore token with a previous-ssp token. The instruction sets the CF flag to </tspan><tspan y="-498" x="46.019989 48.480591 54.122692 59.724293 62.120995 66.804596 72.208199 75.808205 81.150604 83.9748 91.331398 97.022995 102.38159 105.9222 111.61379 116.97239 120.80999 123.63419 127.17479 132.86639 138.26909 141.09329 147.1566 153.28021 158.70181 161.52602 166.92961 172.53122 178.13281 181.97041 187.32901 192.0126 196.6962 199.5798 203.3616 208.7643 213.44789 218.90549 222.74309 228.3447 233.70329 239.3049 242.1291 244.58971 250.28131 253.10551 256.64612 262.33771 267.69632 270.5799 275.26349 280.95508 286.35867 291.96027 297.41788 304.67456 308.75516 313.43875 316.97934 322.38293 327.06653 331.92834 336.00894 339.84653 345.24924 349.92923 353.46982 358.92743 362.76501 368.12363 370.94781 374.4884 379.94601 385.16782 390.57053 396.21262 399.09619 402.63678 408.32837 413.73196 417.27255 420.09674 427.35342 432.75702 437.44061 440.32419 445.92578 449.76337 455.22098 459.90457 465.26318 469.94678 474.63037 480.03308 485.63467 488.51825 495.77493 501.17853 505.86212 508.68631 514.40491 517.28851 522.89014 528.21271 531.7533 537.11188">indicate whether the SSP address recorded in the shadow-stack-restore token that was processed was 4 byte </tspan><tspan y="-486.95969" x="46.019989 51.41729 53.87159 56.268291 61.907696 67.592995 72.995697 78.590996 81.855293 84.679497 87.133797 90.398094 95.800797 98.502594 101.76689 104.6505 112.0008 117.6861 123.03841 126.57271 132.25801 137.61031 141.4416 144.3252 149.72249 155.40779 158.23198 163.62927 166.08357 168.53787 174.13318 179.81848 188.56378 193.91608 199.60138 203.13568 205.95987 211.64517 217.09647 219.55077 224.90306 227.72725 234.98395 240.38754 245.06485 247.94844 252.62575 256.45706 261.80936 267.20667 270.74097 276.14368 281.73898 284.5632 291.91351 297.5997 302.95651 308.6463 311.47049 315.00928 320.69907 326.05588 328.93945 332.77524 338.13205 342.81384 346.35263 351.80844 355.64423 361.00104 365.07983 369.76163 375.45142 380.85321 386.453 391.90881 399.1655 403.24429 407.92609 411.52606 416.92966 421.61145 426.93225 429.81583 433.35461 438.81042 444.03223 449.37463 455.06442 457.88861 465.14529 470.54889 475.28918 478.11337 483.71317 489.40295 494.08475 499.77454 505.13135 510.73114 513.55536 519.01117 524.70099 527.52521 531.06403 536.75385 539.21265 543.89447">aligned, i.e., whether an alignment hole was created when the restore-shadow-stack token was pushed on this </tspan><tspan y="-475.97968" x="46.019989 50.697289 56.382587 61.779888 67.375191 72.826492 80.176796 83.060402 87.737701 91.272003 96.669304 101.3466 106.6629 109.9272">shadow stack. </tspan><tspan y="-460.97937" x="46.019989 50.942989 56.40329 58.854889 61.306488 66.755089 74.102692 76.554291 82.236893 87.829491 90.713097 96.953697 103.0953 108.4332 115.5126 121.7532 127.81651 133.9581 139.3707 142.25429 144.70589 147.85948 150.74307 156.13766 158.96185 162.79045 168.14005 172.88036 176.42006 181.82095 185.66306 191.06575 195.14455 199.81915 205.50175 210.89636 216.48897 221.93756 229.19426 233.26585 237.94046 241.47206 246.86667 251.54128 256.85489 259.67911 263.21069 268.6593 273.8811 279.28381 284.9664 287.85001 293.53259 298.8822 304.23181 309.83969 314.51788 317.3421 320.87729 326.3295 329.15372 334.74991 340.10312 342.98672 347.66492 352.94882 358.26602 363.61923 369.21542 372.09903 377.55124 383.23743 386.06165 389.59683 395.28302 400.63623 403.51984 409.11603 412.94824 418.30145 423.61865 426.07385 431.47476 437.16095 441.83914 444.72275 449.40094 455.08713 460.48532 466.08151 471.53372 478.88492 481.76852 486.44672 489.9819 495.3801 500.05829 505.37549 508.64069 511.52429 517.21051 521.88873 527.24194 530.06616 533.60138 539.2876 544.64081">Following RSTORSSP if a restore-shadow-stack token needs to be saved on the previous shadow stack, use the </tspan><tspan y="-449.99936" x="46.019989 52.084187 57.968384 64.113586 69.790787 75.206985 81.451187 87.128387 93.313187 99.317986 105.50278 110.91898 113.80259 116.25779 121.94399 126.62219 130.15739 133.98959 139.6758 144.354 147.88921 150.34441 155.7966 161.4828 164.748">SAVEPREVSSP instruction. </tspan><tspan y="-434.99905" x="46.019989 49.80629 52.971588 55.495186 61.099487 66.793785 71.480087 77.174385 79.637688 85.279785 90.884087 93.407684 98.813988 101.39789 105.17969 110.58238 115.26868 118.81198 124.27228 128.11258 133.47388 137.55717 142.24347 147.93777 153.34407 158.94836 164.40866 171.66536 175.74866 180.43495 183.97826 189.38455 194.07085 199.39615 201.91975 205.46306 210.92336 216.14516 221.54785 227.24216 229.76576 235.22606 240.92036 243.44397 246.98727 252.68158 258.04288 260.5665 266.17081 270.01111 275.37241 280.69769 283.09439 288.55469 294.24899 298.9353 301.44 306.12 311.76208 317.16208 322.76007 328.21408 335.56708 338.15097 342.83096 346.36795 351.76794 356.44794 361.76694 364.35083 366.74753 371.42752 374.01141 379.6994 385.15341 388.6904 391.21399 395.048 400.40302 406.00101 411.689 414.146 417.98001 423.33502 428.93301 432.20001 434.7236 438.26059 443.94858 449.35129 451.87488 457.47287 461.30688 466.6619 471.9809 474.4379 479.89191 485.5799 490.25989 494.33688 499.01688 503.69687 509.29486 511.81845 515.35547 520.80945 526.12842 531.4834 537.17139 539.69501 544.375 549.77502 555.46301">If pushing a restore-shadow-stack token on the previous shadow stack is not required, the previous-ssp token can </tspan><tspan y="-423.95874" x="46.020004 51.611706 56.960407 59.484005 65.123405 70.58371 76.175407 81.767105 87.169807 92.761505 95.28511 100.96681 105.64051 108.09121 113.77291 119.41231 121.93591 125.46661 131.14832 136.55101 139.0746 142.8483 149.565 155.8317 161.895 168.0789 173.4789 180.5466 183.07019 185.52089 191.20259 195.8763 199.407 203.2347 208.9164 213.5901 217.1208 219.5715 225.0192 230.7009 233.96159 236.48518 240.25888 243.41158 245.93517 249.46587 255.14757 260.49628 263.0199 269.28659 274.44629 276.96991 280.12262 282.57333 287.96704 293.60645 296.13007 303.38678 308.79037 313.46408 315.95972 320.64243 326.00012 329.53983 332.06345 335.60315 341.05984 343.58347 346.04315 351.68524 357.28595 359.68265 364.42294 369.82654 373.36624 378.72394 381.24756 386.84827 390.68497 396.04266 400.72537 406.08307 411.77377 416.45648 421.81418 424.3378 429.79449 432.95621 435.47983 440.88254 446.57324 449.09686 454.49957 456.95926 459.41895 465.01965 470.71036 479.46106 484.81876 490.50946 494.04916 496.57278 502.26349 507.6644 510.12408 515.48181 518.75153 521.27509 526.6778 532.36847 534.89203 540.29474 545.89545 551.49615 553.95587">be popped using the INCSSPQ instruction. If the CF flag was set to indicate presence of an alignment hole, an addi-</tspan><tspan y="-412.97873" x="46.02002 49.557018 52.014019 57.414917 63.116417 68.516418 70.973419 73.857018 77.637016 84.360016 90.633018 96.69632 102.84332 108.26132 115.19132 118.07493 120.47163 126.17313 130.85312 134.39012 138.22412 143.91212 148.59213 152.12914 154.58614 160.04013 165.72813 168.55234 171.00934 175.68933 178.51353 184.20154 189.60423 194.95923 200.55724 205.91223 211.51024 214.33444 217.87144 223.32544 226.20003 231.59464 237.18724 242.34874 247.75235 253.43495 258.17526 263.52487 266.34909 269.88068 275.56326 280.91287 283.79648 289.85977 295.98337 301.39597 304.27957 309.87216 315.26675 319.94135 323.47293 326.35654 329.88812 335.57071 340.92032 343.74454 349.13913 351.59073 354.04233 359.63492 365.3175 374.06012 379.40973 385.09232 388.6239 391.44812 397.13071 402.57932 405.03091 410.38052">tional INCSSPD instruction is needed to advance the SSP past the alignment hole.</tspan></text><text xml:space="preserve" transform="translate(0,792)" font-size="9.96" class="cC28FA1AE cD0BE81C2 c209E837B"><tspan y="-388.32001" x="46.02 52.630455 58.270802 63.845413 67.26767 72.573364 76.594215 79.08123 84.720589">Operation</tspan></text><text xml:space="preserve" transform="translate(0,792)" font-size="9" class="c9256B18F cAF7646FE"><tspan y="-375.95999" x="46.02 48.120602 52.801502 55.020905 59.749504 64.874107 69.341705 71.561104 76.685707 78.905106">IF CPL = 3</tspan><tspan y="-363.9603" x="59.52 61.621502 66.351006 68.570404 71.166901 75.8964 81.327904 86.597404 88.277702 93.018906 97.699806 102.91801 105.13741 111.0909 113.3103 115.4118 121.02331 126.29281 131.51282 136.07132 141.76382 146.26472 150.99423 155.72374 160.91225 162.62674 167.36884 173.22334 177.78185 182.56534 187.75385 193.01434 197.51524 202.24475 208.09926 210.69576 212.91515 218.04065 220.26004">IF (CR4.CET &amp; IA32_U_CET.SH_STK_EN) = 0</tspan><tspan y="-351.9606" x="77.520004 82.702202 88.5504 93.273598 99.121796 101.34119 107.1084 112.7946 118.3278 120.19801 122.4174 127.1406 129.23581">THEN #UD; FI;</tspan><tspan y="-339.96091" x="46.020004 50.704506 55.203606 59.942108">ELSE</tspan><tspan y="-327.96121" x="59.520004 61.618805 66.345604 68.565002 71.158806 75.885605 81.314407 86.581207 88.261505 93.002701 97.683601 102.9018 105.1212 111.072 113.2914 115.3902 120.999 126.2658 131.48579 136.0416 140.82239 145.32329 150.05009 154.7769 159.96271 161.64302 166.44543 172.29724 176.85304 181.63385 186.81966 192.03966 196.60086 201.32767 207.17947 209.77327 211.99268 217.11548 219.33487">IF (CR4.CET &amp; IA32_S_CET.SH_STK_EN) = 0</tspan><tspan y="-315.96152" x="77.520004 82.702202 88.5504 93.273598 99.121796 101.34119 107.1084 112.7946 118.3278 120.19801 122.4174 127.1406 129.23581">THEN #UD; FI;</tspan><tspan y="-303.96182" x="46.020004 50.700905 52.801502">FI;</tspan><tspan y="-279.96152" x="46.020004 50.783707 55.586109 60.691811 65.230515 69.679214 75.318611 77.538017 82.643715 84.863121 89.311821 91.293617 96.05732 100.79762 105.25532 108.50702 113.04572 118.68512 123.33182 127.97852 131.23021 135.9705 139.96921 143.96791 146.54462 153.47731 158.17801 165.1107 167.33011 172.03981 176.68651 181.4268 184.66859 189.16769 193.90979 198.55649">SSP_LA = Linear_Address(mem operand)</tspan><tspan y="-267.96182" x="46.020004 48.126904 52.807804 55.027203 59.816101 64.558205 69.689102 74.190002 78.663902 84.243896 86.463303 91.252205 95.933105 99.318008 101.53741 106.02032 107.95621 109.87772 114.55682 119.34572 124.02662 128.69852 130.91791 134.30281 138.9837 141.20309 146.478 148.69739 153.36929 158.05919 161.44409 166.125">IF SSP_LA not aligned to 8 bytes</tspan><tspan y="-255.96213" x="59.520004 64.700401 70.546799 75.268196 81.114594 83.333992 89.099396 94.369797 99.487198 102.0756 107.337 109.9254 111.7938 114.0132 118.7346 120.828">THEN #GP(0); FI;</tspan><tspan y="-231.96182" x="46.020004 50.639706 53.941807 58.622707 63.301807 65.223312 69.964516 74.706619 78.728722 83.289925 87.311127 91.272926 95.952026 100.51323 103.89543 108.62763 112.91883 117.59973 122.40213 124.62153 129.74973 131.96912 136.75531 141.49741 146.62561 148.845 150.76651 152.9859 155.5851 157.6893 163.3035 168.5757 173.8479 178.4091 183.1413 187.8735 192.55441 197.98862 199.60951 204.08072 210.62102 216.23521 218.45461 224.0688 229.92599 235.4682 237.68759 242.4198 247.1619 248.87909 253.3503 255.94949 258.16888 260.12909 262.34848 267.56848 272.36636 277.63855">previous_ssp_token = SSP | (IA32_EFER.LMA AND CS.L) | 0x02</tspan><tspan y="-219.96213" x="46.020004 50.771103 54.191101 58.6362 61.875301 65.222404 67.441803 73.081207 76.44091 81.182106 88.082405 90.064209 93.963905 96.183304 100.8804 105.67831 110.41861 114.31831 119.0694 122.4165 124.39831 129.13951">Start Atomic Execution</tspan><tspan y="-207.96243" x="46.020004 49.287003 54.003002 57.964802 61.3848 66.065704 69.367805 74.083809 78.63781 82.65181 86.66581 91.285515 95.839516 99.214516 103.93951 108.22351 112.93951 117.71851 119.93791 125.05891 127.27831 131.74231 136.42322 140.32922 144.61322 149.32922 153.99123 156.21063 160.22464 165.00365 169.47665 174.13866 178.86366 185.70001 190.26031 194.28061 197.66191 202.1412 206.0535 210.3438 214.9041 216.8364 221.51729 226.01639 230.63609 232.85548 238.12679 240.34618 245.01448 249.70078 253.08208 257.80438 261.82468 264.0441 267.3894 270.66269 275.39398 282.29428 284.5137 289.29901 294.08432 299.21161 303.71252 308.18283">restore_ssp_token = Locked shadow_stack_load 8 bytes from SSP_LA</tspan><tspan y="-195.96274" x="46.020004 49.332005 53.831104 58.583103 60.482101 63.9021 66.121498 71.2155 73.434898">fault = 0</tspan><tspan y="-171.96243" x="46.020004 48.117905 52.798805 55.018204 57.611103 60.204002 63.471901 68.152802 72.167702 75.543602 80.269501 83.537399 88.254303 92.809204 96.824104 100.7859 105.44881 110.00371 113.37961 118.10551 122.3904 127.0713 131.85121 134.07062 140.02052 142.23993 147.50583 152.24342 157.50932 162.77522 165.36812 167.58752 169.33443 174.45633 176.67574 179.26863 181.36653 186.97443 192.24033 197.50623 202.00713 206.73303 211.45894 216.13985 221.56775 223.27866 227.74356 234.32346 239.93135 242.15076 248.10066 250.32007 255.04597 259.78806 261.49896 265.96387 268.55676">IF ((restore_ssp_token &amp; 0x03) != (IA32_EFER.LMA &amp; CS.L))</tspan><tspan y="-159.96274" x="59.520004 64.697708 70.541412 75.260117 81.103821 83.323219 86.655922 91.12262 95.895317 97.815018 101.18372 103.40311 108.51781 110.73721 115.99591 117.86161 120.08101 124.79971 126.84091 149.46062 152.09941 156.1161 158.33551 160.37671 163.7355 165.95491 170.41261 172.63202 175.96472 177.88441 182.35112 187.00682 189.22623 191.17293 195.94563 198.16504 201.53374 206.25244 210.53014 215.23984 220.01254 222.23195 226.88765 231.60635 236.31606 240.32376 242.54317 247.31587 252.12 255.48599 257.70538 264.64438 269.10837 272.47437 276.37137 281.14136 283.36075 285.44876 291.04675 296.30276 301.55878 306.10379 310.81979 315.5358 320.2518 325.6698 327.4104 331.86539 338.43539 344.03339 346.25278 352.19278 354.41217 359.12817 363.89816 365.63876 370.07755 372.29694 377.01294 380.27094 382.49033 387.14334 389.08734 392.45334 394.67273 399.92874 402.14813 404.09213 408.09714 410.31653 415.08652 419.80252 423.2225 425.44189 430.69791 432.9173 436.9313">THEN fault = 1; FI;(* If L flag in token does not match IA32_EFER.LMA &amp; CS.L or bit 1 is not 0 *)</tspan><tspan y="-135.96243" x="46.020004 48.099903 52.807804 55.027203 57.602104 60.240906 62.320805 67.910706 73.158607 78.406509 82.943413 87.651314 92.359215 97.067116 102.47701 104.21761 108.66451 115.22641 120.86581 123.08521 128.67511 134.50801 140.08621 142.30562 147.01352 151.81592 153.50882 158.00792 160.58282 162.80223 167.90613 170.12553 175.37343 177.59283 183.18274 189.01564 194.53354 196.75294 200.05504 204.73593 208.73283 212.09073 216.79863 220.04852 224.78882 229.28972 233.28662 237.28352 241.92842 246.46532 249.88531 254.59322 258.91229 263.61121 268.4136 271.15952 276.40741 281.6553 283.39322 288.64111 293.88901 296.63492 298.85431 300.58322 305.74472 307.96411 313.21201">IF ((IA32_EFER.LMA AND CS.L) = 0 AND restore_ssp_token[63:32] != 0)</tspan><tspan y="-123.96273" x="59.520004 64.704903 70.555801 75.2817 81.132599 83.351997 86.691895 91.131592 95.911491 97.838394 101.21429 103.43369 108.5556 110.77499 116.04089 117.9138 120.13319 124.85909 126.90029 149.51999 152.15878 156.18268 158.40208 160.44328 163.80209 166.0215 169.92841 174.65431 181.55461 186.23372 190.67342 194.09341 196.01492 200.69403 202.61554 204.53703 206.49094 209.86684 214.54773 217.68063 219.60753 224.28844 228.95134 233.42523 237.33214 241.95183 244.20001 251.16061 255.90181 260.54041 265.2807 267.50009 271.94968 276.75208 281.39069 283.61008 288.41248 293.1546 298.3161 300.53549 303.88708 308.6283 310.84769 315.4863 320.22659 322.44598 325.68958 330.38217 334.40427 337.76395 342.50516 345.74695 350.48724 355.16635 357.38574 362.14136 366.88257 370.23416 372.45355 377.13266 381.81357 383.71616 388.45737 395.38196 397.60135 402.88165 408.16196 410.38135 414.38095">THEN fault = 1; FI;(* If compatibility/legacy mode and SSP to be restored not below 4G *)</tspan><tspan y="-99.962433" x="46.020004 51.201305 57.777607 62.895908 65.115311 70.233612 72.453011 75.717308 80.430611 84.44191 87.814209 92.536507 95.800804 100.51411 105.06541 109.07671 113.08801 117.70771 122.25901 125.63131 130.35361 134.6349 139.34821 144.12451 146.34392 152.29022 154.50963 159.63693 164.85693 169.64223 174.90453">TMP = restore_ssp_token &amp; ~0x01</tspan><tspan y="-87.96273" x="46.020004 51.195904 57.766804 62.879704 65.099106 70.212006 72.431404 75.015305 80.191208 86.762108 91.875008 94.094406 96.921303 99.140701 104.3976">TMP = (TMP - 8)</tspan><tspan y="-75.963028" x="46.020004 51.191406 57.757805 62.866203 65.085609 70.194008 72.413414 77.584816 84.151215 89.259613 91.479019 97.415421 99.634827 104.75223 110.00463 114.78003 120.03243">TMP = TMP &amp; ~0x07</tspan></text><text xml:space="preserve" transform="translate(0,792)" font-size="9" class="c9256B18F cD0BE81C2"><tspan y="-694.98303" x="52.020306 57.977406 63.016506 67.035912 72.075012 77.114113 82.135216">Opcode/</tspan><tspan y="-684.00305" x="52.020306 54.417908 59.578506 63.777908 67.378807 70.649406 75.810005 79.908607 83.494209 85.738808 90.773407">Instruction</tspan><tspan y="-694.98303" x="175.3203 181.28909 186.33989 189.77069">Op/ </tspan><tspan y="-684.00305" x="175.3203 180.35849">En</tspan><tspan y="-694.98303" x="202.3203 207.8382 213.4164 216.8373 222.35519 227.87309">64/32 </tspan><tspan y="-684.00305" x="202.3203 207.37019 209.64989 213.23279 214.79248 221.71439 226.74629 231.79619 236.82809">bit Mode </tspan><tspan y="-673.02307" x="202.3203 207.3378 212.5083 217.5708 222.6333 227.6778 230.9583">Support</tspan><tspan y="-694.98309" x="250.38029 255.3051 260.8266 266.84039 269.2272 275.043">CPUID </tspan><tspan y="-684.00311" x="250.38029 255.0585 260.03821 264.83609 268.43698 273.59488 276.71698 281.75607">Feature </tspan><tspan y="-673.02313" x="250.38029 255.38159 257.64688 262.44119">Flag</tspan><tspan y="-694.98315" x="308.10001 313.9653 318.94501 323.2713 327.35101 330.66031 332.88062 337.80093 341.40182 343.62213 348.66122">Description</tspan></text><text xml:space="preserve" transform="translate(0,792)" font-size="9" class="c9256B18F cAF7646FE"><tspan y="-660.00287" x="52.020294 56.701195 61.981499 64.200905 69.475807 74.156708 76.376114 81.651016 86.925919 89.145325 92.287224 97.507225 99.726631 102.32853 109.22883 113.96373 118.58343 120.33932 125.47022 130.69022 135.97052 137.80742 140.02681 143.16872 148.44362 150.28052">F3 0F 01 /5 (mod!=11, /5, </tspan><tspan y="-649.02289" x="52.020294 58.946693 63.686993 70.647598 75.328499 78.6306 83.250305 85.469704 90.210907 95.013306 96.917709 101.59771">memory only)</tspan><tspan y="-637.9826" x="52.020294 57.422997 62.225395 67.083595 72.781494 78.184196 82.986595 87.741295 92.902794 95.122192 102.04589 107.28659">RSTORSSP m64</tspan><tspan y="-660.00293" x="175.32028 202.32028 208.02179 211.1664 250.4073 255.1449 259.82581 265.0224 269.58899 274.33109 308.11346 313.39288 318.13318 322.0347 325.27469 330.0123 333.0741 337.8027 340.02209 344.76419 349.56659 353.8884">MV/VCET_SSRestore SSP.</tspan><tspan y="-577.98322" x="69.720581 75.478783 80.098488 83.216995 87.958191 150.95999 156.71819 161.33789 166.0782 169.14 173.57971 178.38213 183.06123 185.28064 259.92123 265.61914 270.29822 274.97913 278.04092 282.54001 287.2821 291.96118 294.18057 369.2406 374.99881 379.6185 384.3588 387.42059 391.86029 396.66269 401.28238 403.50177 481.08179 486.77969 491.45877 496.19907 499.26086 503.70056 508.50296 513.12268 515.3421">Op/EnOperand 1Operand 2Operand 3Operand 4</tspan><tspan y="-562.0235" x="77.940277 138.54088 145.08119 149.7972 154.4502 159.90959 166.44991 168.19591 171.498 174.621 181.56 183.7794 186.3624 189.42419 191.24219 193.46159 200.40059 273.95938 279.80038 383.30038 389.14139 495.10107 500.94208">MModRM:r/m (r, w)NANANA</tspan></text><path transform="matrix(1,0,0,-1,0,792)" d="m 45.78,623.22 h 0.47998 v 80.52 H 45.78 Z" inkscape:connector-curvature="0" /><path transform="matrix(1,0,0,-1,0,792)" d="m 169.08,622.74 h 0.48 v 81.48 h -0.48 z" inkscape:connector-curvature="0" /><path transform="matrix(1,0,0,-1,0,792)" d="m 196.08,622.74 h 0.48 v 81.48 h -0.48 z" inkscape:connector-curvature="0" /><path transform="matrix(1,0,0,-1,0,792)" d="m 244.14,622.74 h 0.48 v 81.48 h -0.48 z" inkscape:connector-curvature="0" /><path transform="matrix(1,0,0,-1,0,792)" d="m 301.8,622.74 h 0.48 v 81.48 h -0.48 z" inkscape:connector-curvature="0" /><path transform="matrix(1,0,0,-1,0,792)" d="m 558.24,623.22 h 0.48006 v 80.52 H 558.24 Z" inkscape:connector-curvature="0" /><path transform="matrix(1,0,0,-1,0,792)" d="m 45.78,703.74 h 512.94 v 0.48 H 45.78 Z" inkscape:connector-curvature="0" /><path transform="matrix(1,0,0,-1,0,792)" d="m 45.78,668.76 h 512.94 v 0.48 H 45.78 Z" inkscape:connector-curvature="0" /><path transform="matrix(1,0,0,-1,0,792)" d="m 45.78,622.74 h 512.94 v 0.48 H 45.78 Z" inkscape:connector-curvature="0" /><path transform="matrix(1,0,0,-1,0,792)" d="m 46.32,557.22 h 0.48001 v 31.5 H 46.32 Z" inkscape:connector-curvature="0" /><path transform="matrix(1,0,0,-1,0,792)" d="m 115.62,556.74 h 0.48001 v 32.52 H 115.62 Z" inkscape:connector-curvature="0" /><path transform="matrix(1,0,0,-1,0,792)" d="m 225.36,556.74 h 0.48 v 32.52 h -0.48 z" inkscape:connector-curvature="0" /><path transform="matrix(1,0,0,-1,0,792)" d="m 333.48,556.74 h 0.48 v 32.52 h -0.48 z" inkscape:connector-curvature="0" /><path transform="matrix(1,0,0,-1,0,792)" d="m 444.06,556.74 h 0.47999 v 32.52 H 444.06 Z" inkscape:connector-curvature="0" /><path transform="matrix(1,0,0,-1,0,792)" d="m 557.16,557.22 h 0.47998 v 31.5 H 557.16 Z" inkscape:connector-curvature="0" /><path transform="matrix(1,0,0,-1,0,792)" d="m 46.32,588.78 h 511.32 v 0.48 H 46.32 Z" inkscape:connector-curvature="0" /><path transform="matrix(1,0,0,-1,0,792)" d="m 46.32,572.76 h 511.32 v 0.48 H 46.32 Z" inkscape:connector-curvature="0" /><path transform="matrix(1,0,0,-1,0,792)" d="m 46.32,556.74 h 511.32 v 0.48 H 46.32 Z" inkscape:connector-curvature="0" /></g></svg><br/><br/><svg xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape" version="1.1" width="500.24762pt" height="611.47266pt" viewBox="0 0 500.24762 611.47266" sodipodi:docname="1306.svg" inkscape:version="0.92.5 (2060ec1f9f, 2020-04-08)"><metadata><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage" /></cc:Work></rdf:RDF></metadata><defs /><sodipodi:namedview pagecolor="#ffffff" bordercolor="#666666" borderopacity="1" objecttolerance="10" gridtolerance="10" guidetolerance="10" inkscape:pageopacity="0" inkscape:pageshadow="2" inkscape:window-width="640" inkscape:window-height="480" showgrid="false" inkscape:zoom="0.22348485" inkscape:cx="348.01578" inkscape:cy="379.77406" inkscape:window-x="0" inkscape:window-y="0" inkscape:window-maximized="0" inkscape:current-layer="svg128" /><g transform="translate(-44.988167,-69.35791)" class="c9D877B2B"><text xml:space="preserve" transform="translate(0,792)" font-size="9" class="c9256B18F cAF7646FE"><tspan y="-715.97998" x="45.119999 47.204399 51.916801 54.1362 59.354401 65.894699 71.003098 73.222504 74.955902 80.117401 82.336807 87.10321 91.869614 96.978012 101.51941 105.97081">IF TMP != SSP_LA</tspan><tspan y="-703.98029" x="58.619999 63.808498 69.663002 74.392502 80.247002 82.4664 85.809898 90.249596 95.033096 96.963593 100.34309 102.56249 107.688 109.90739 115.1769 117.0534 119.2728 124.0023 126.0435 148.7235 151.30289 155.33038 157.54977 159.65128 162.95068 165.17007 169.64757 174.26727 178.93378 182.20528 186.92578 190.88757 194.90607 197.12546 199.08296 203.82506 206.04445 209.42395 214.15346 218.44196 223.16246 227.90456 230.0997 234.75 239.4633 244.1676 248.16991 250.38931 255.15662 259.8699 263.23322 265.45261 272.38892 276.85022 280.27023 284.16992 288.93723 291.15662 294.51993 299.28723 303.99155 306.21094 309.51306 314.19397 318.84427 323.61157 328.31589 332.31818 335.68149 340.3858 345.0361 347.25549 350.6188 355.33209 359.98239 362.20178 366.91507 370.24237 372.46176 376.46405 379.88406 384.34537 388.23965 392.51196 394.73135 398.74265">THEN fault = 1; FI;(* If address in token does not match the requested top of stack *)</tspan><tspan y="-679.97998" x="45.119995 50.292297 56.859596 61.968895 64.189194 69.298492 71.518799 74.099098 77.426399 81.887695 86.654999 88.569298 91.932602 94.152908 99.262207 104.42461 106.64491 111.89822 114.47852 116.69882 120.65972 122.88002 127.53032 130.83331 135.53761 140.16991 142.1526 146.83441 151.60172 155.5797 160.1337 164.0955 168.1095 172.7715 177.3255 180.7005 185.38141 189.7005 194.4165 199.19551 201.41492 203.16992 205.38933 208.65633 213.37233 217.38632 220.76132 225.48633 228.75333 233.46933 238.02333 242.03732 246.05133 250.67104 255.22504 258.60004 263.32504 267.60904 272.32504">TMP = (fault == 0) ? previous_ssp_token : restore_ssp_token</tspan><tspan y="-667.98029" x="45.119995 49.128593 53.902195 58.369797 63.026398 67.746002 74.688599 79.237198 83.245796 86.615395 91.082993 94.983589 99.262192 103.81079 107.81939 111.18899 115.90858 119.21068 123.89158 126.11098 131.37057 133.5603 138.2142 142.88611 146.30611 150.98701 154.99292 157.21233 161.92923 165.26013 167.47954 172.65544 179.22635 184.33925 186.55865 189.92555 194.64246 196.86186 201.63277 206.40367 211.51657 216.06247 220.51837 226.15778 228.37718 232.84209 237.61299 242.26689 244.4863 247.78839 252.4693 254.38721 259.09509 263.56 267.56589 272.27377 274.49316 276.41107 281.12796 285.02585">shadow_stack_store 8 bytes of TMP to SSP_LA and release lock</tspan><tspan y="-655.98059" x="45.120003 49.800903 54.603306 59.274307 61.493706 67.109703 70.493706 75.227707 82.128006 84.090004 88.005005 90.224403 94.958405 99.695999 104.421 108.336 113.0781 116.43781 118.3998 123.1338">End Atomic Execution</tspan><tspan y="-631.98029" x="45.120003 47.217003 51.8979 54.117298 57.456299 61.929298 66.708298 68.6343 72.0093 74.228699 79.349701 84.470703 86.690102">IF fault == 1</tspan><tspan y="-619.98059" x="45.120003 47.339405 49.558807 51.77821 53.997612 59.174412 65.017212 69.735016 75.57782 77.797218 83.559021 88.276825 93.390625 96.029427 101.44923 106.22102 111.39783 117.12363 122.54343 127.31522 132.08702 137.20082 139.78561 141.65042 143.86983 148.58763 150.67743">    THEN #CP(RSTORSSP); FI;</tspan><tspan y="-595.98029" x="45.120003 49.883705 54.647408 59.753109 61.972507 67.078209 69.297615 74.061317 78.82502 83.986519 88.547722 92.996422">SSP = SSP_LA</tspan><tspan y="-571.97998" x="45.120003 48.245705 51.371407 53.590809 58.36351 63.073212 66.44191 68.661308 72.030006 76.802704 81.512405 83.731804 88.4505 93.169205 95.388603 97.335304 100.66801 102.88741 106.2561 111.0288 115.7385 117.9579 122.7306 127.5033 132.618 134.8374 136.7841 141.55681 143.77621 147.19621 151.93832 156.64803 158.86743 162.12813 166.86031 170.86081 174.28081 178.99231 182.2944 186.9969 189.21631 192.5778 197.28931 201.55981 206.26231 211.02782 213.24722 220.18172 224.64122 228.64172 230.86113 236.11263 238.33203 242.98053 247.64703 251.00853 255.71103 257.93042 262.38992 264.30243 266.24194 270.89044 275.65594 280.35846 285.00696 286.86548 289.14062 291.07654 292.76944 297.50977 299.19006 301.04858 303.26797 306.62589 311.42828 316.1272 319.37711 324.11743 326.33682 328.27274 332.26962 334.48901 338.98813 343.73022 345.94962 350.44873 352.37024 354.30615 358.98526 363.74716 370.67807 375.4184 380.16049 383.5184 385.73779 390.54019 395.22107 397.12997">// Set the CF if the SSP in the restore token was 4 byte aligned, i.e., there is an alignment hole</tspan><tspan y="-559.98029" x="45.120926 50.547928 55.272926 59.736927 65.343925 70.617928 75.396927 77.106926 81.831924 86.556923 88.776321 93.897324 96.116722 98.708725 101.97572 106.69173 110.70573 114.08073 118.76163 122.02863 126.70953 131.26352 135.27753 139.29153 143.91124 148.46524 151.84024 156.56525 160.84924 165.56525 170.30736 172.52676 178.47577 180.69518 185.96017 190.74817 195.96817 201.24847 203.84047 206.05988 209.98387 212.20328 217.46828 219.68768 221.44269 223.66209 228.92709">RFLAGS.CF = (restore_ssp_token &amp; 0x04) ? 1 : 0;</tspan><tspan y="-547.98059" x="45.120926 50.520924 55.262123 59.700924 65.28093 70.571129 75.366333 77.046631 82.264832 86.945732 88.80423 93.905426 98.586327 100.42953 106.00953 110.75073 112.54984 118.29903 122.97993 124.82314 129.56523 134.30643 136.52582 138.29701 143.39822 145.61761 150.89882">RFLAGS.ZF,PF,AF,OF,SF := 0;</tspan></text><text xml:space="preserve" transform="translate(0,792)" font-size="9.96" class="cC28FA1AE cD0BE81C2 c209E837B"><tspan y="-523.32001" x="45.119999 50.661743 53.175648 58.488312 64.128654 68.88356 71.403435 77.462105 81.360443 85.079506 90.718857 95.264603 99.24263 104.82421">Flags Affected</tspan></text><text xml:space="preserve" transform="translate(0,792)" font-size="9" class="c9256B18F cECB6486A"><tspan y="-502.98001" x="45.119999 51.396599 56.619301 59.743202 62.203804 66.887405 70.071609 74.755211 80.113808 83.654411 86.838615 90.379219 95.836823 99.021027 101.41772 107.11922 112.72083 115.18143 119.86503 125.26863 128.80923 134.16783 137.29173 139.75233 142.91493 146.03883 149.57944 155.27104 160.62964 163.75354 168.43713 174.12874 179.53233 185.13394 190.53484 197.91124 201.09544 205.77904 209.31964 214.72324 219.40683 224.72943 227.85333 233.45493 238.91252 241.30922 247.01073 250.55133 255.90993 259.74753 262.93173 265.39233 271.08392 274.20782 277.74841 283.44 288.79861 292.01971 295.8555 301.21231 305.8941 309.49408 314.89499 318.73706 324.13977 327.26367 330.80246 336.25827 341.57907 346.93588 352.62567 355.80988 363.16467 368.56647 373.24826 376.43246 382.14926 385.33347 390.93326 396.25406 399.79285 405.14966 408.33386 413.73566 416.19446 418.65326 424.25305 429.94284 435.29965 440.89944 444.16824 447.35245 452.70926 455.16806 459.84985 465.20667 468.39087 470.84967 474.38846 477.51236 479.97116 484.65295 487.83716 492.51895 494.97775 500.33456 505.73636 509.57214 514.92896 520.52875 523.79755 526.98175 533.13953 538.30731 541.57611">CF is set to indicate if the shadow stack pointer in the restore token was 4 byte aligned, else it is cleared. ZF, </tspan><tspan y="-492" x="45.12001 50.520012 55.682411 58.968311 62.152512 68.276115 73.438515 76.724411 79.848312 86.941216 92.126114 95.412018 98.596222 104.01512 109.72202 115.30202 118.48622 124.60983 129.77222 132.95642 138.37532 142.22823 147.57063 150.75484 155.45374 157.92964 163.27205 168.67564 172.52855 177.87096 183.48785">PF, AF, OF, and SF are cleared.</tspan></text><text xml:space="preserve" transform="translate(0,792)" font-size="9.96" class="cC28FA1AE cD0BE81C2 c209E837B"><tspan y="-467.34" x="45.119999 50.603973 54.424629">C/C</tspan></text><text xml:space="preserve" transform="translate(0,792)" font-size="9.96" class="cC28FA1AE c8037F88D c209E837B"><tspan y="-467.34" x="59.879723 65.399551">++</tspan></text><text xml:space="preserve" transform="translate(0,792)" font-size="9.96" class="cC28FA1AE cD0BE81C2 c209E837B"><tspan y="-467.34" x="70.859627 73.379509 78.86647 84.462997 92.748718 98.365166 100.82529 103.34617 108.9427 112.58706 115.10694 117.78519 123.36279 127.35575 131.00012 133.50905 139.24501 144.01486 146.47499 151.03568 153.55556 159.11224 164.72868 170.46465 172.97357 178.19461 183.53218 186.06102 191.65755 197.23514"> Compiler Intrinsic Equivalent</tspan></text><text xml:space="preserve" transform="translate(0,792)" font-size="9" class="c9256B18F cAF7646FE"><tspan y="-450" x="45.119999 50.547001 55.326 60.510002 66.243004 71.670006 76.449005 81.228004 89.149811 93.793808 98.518806 100.47181 105.13381 107.35321 111.90721 115.17421 119.18821 122.56321 127.28821 130.55521 134.56921 138.58322 143.20293 145.79492 150.43892 155.11983 157.10162 161.72133 163.94073 167.96373 170.55573">RSTORSSPvoid _rstorssp(void *);</tspan></text><text xml:space="preserve" transform="translate(0,792)" font-size="9.96" class="cC28FA1AE cD0BE81C2 c209E837B"><tspan y="-426.29999" x="45.119999 51.181656 54.603912 60.003227 63.964321 69.569809 74.139458 78.100555 83.680145 89.305557 91.825439 99.52253 105.12802 110.75343 116.35892 118.8788 124.39764 129.68042 134.11958 139.69917 145.15926 149.12035 151.63823 157.24371 162.98865">Protected Mode Exceptions</tspan></text><text xml:space="preserve" transform="translate(0,792)" font-size="9" class="c9256B18F cECB6486A"><tspan y="-411.95999" x="45.119999 52.471199 59.048401 137.23322 141.01411 144.17131 146.9955 150.5307 156.2169 161.5701 164.45369 169.37669 176.4561 182.72729 188.95349 191.77768 197.41708 201.25919 206.61238 209.76958 212.22478 217.54198 220.42557 222.82227 227.50227 230.38586 236.07207 240.75027 246.10347 251.69968">#UDIf the LOCK prefix is used.</tspan><tspan y="-397.98029" x="137.2197 140.99069 144.14069 146.96487 153.22888 159.46588 165.17188 168.47397 174.73798 180.40797 185.93398 188.81757 196.16156 199.04515 204.75114">If CR4.CET = 0.</tspan><tspan y="-384.00058" x="137.2197 140.99159 146.14949 149.03308 155.29797 160.75737 165.75327 168.57745 175.92235 178.74654 184.50923 187.33342 192.72533 198.40523 203.99513 206.87872 210.65062 216.78952 222.55222 228.25911 233.966 240.53691 246.2438 252.5087 258.1796 262.43747 265.73959 271.86319 278.6051 284.31201 290.4509 296.02908 302.24899 307.9559 313.6268 320.40649 323.23071 330.57562 333.39984 339.10675">IF CPL = 3 and IA32_U_CET.SH_STK_EN = 0.</tspan><tspan y="-369.96057" x="137.2197 140.98709 146.14049 149.02408 155.28448 160.74388 165.73528 168.55946 175.89986 178.72404 184.48676 187.31094 192.69835 198.37375 203.95915 206.84274 210.61014 216.74454 222.50725 228.20966 233.91206 240.09596 245.79837 252.05878 257.72519 261.98309 265.28519 271.40878 278.14618 283.84857 289.98297 295.56116 301.77655 307.53925 313.20566 319.91605 322.79965 330.14005 333.02365 338.72604">IF CPL &lt; 3 and IA32_S_CET.SH_STK_EN = 0.</tspan><tspan y="-355.98087" x="45.119995 52.471195 59.435394 64.894791 68.973595 74.686798 137.26559 141.04379 144.20099 147.02519 149.48039 151.93559 157.6218 162.97499 168.37318 172.20538 175.02959 180.42778 186.06718 191.66339 195.49559 200.84879 205.52699 210.2052 213.08881 218.541 221.6982 224.5818 233.328 238.6812 247.4274 252.87959 256.71179 262.02899 264.91257 270.36478 275.96097 281.31418 284.97629 290.37448 296.06067 301.70007 304.52426 310.21045 315.66266 319.19785 322.02203 327.78473 330.60892 336.20511 341.52231 345.0575 350.41071 353.23489 358.69879 361.09549 363.55069 369.14688 374.83307 380.18628 385.82568">#GP(0)If linear address of memory operand not 8 byte aligned.</tspan><tspan y="-342.00116" x="137.2197 141.0042 144.16769 146.99188 152.39638 155.27997 163.98297 169.38567 178.13817 183.53906 187.37756 192.70107 195.58466 200.98555 206.62494 211.98444 215.64653 221.05103 226.74353 232.34602 235.22961 240.58911 243.75261 246.91611 252.2756 256.96011 260.50162 262.9631 268.18488 273.54437 276.42798 281.83249 287.435 293.03751 296.81931 302.1788 306.86331 311.54782 314.37204 316.83353 321.51804 324.40164 329.80255 335.50406 339.04556 343.67969 346.15109 351.73019 357.09961 359.92383 363.47522 369.17761 374.51999 377.40359 383.64151 389.7048 392.98621 395.81042 402.75482 408.81812 412.05991 414.94351 420.5802 426.64349 429.9249 432.74911 437.9295 443.9928 447.2742 450.09842 455.56683 459.41522 462.29883 469.27924 475.40283 478.28644 482.98083 488.32321 493.90231 502.66559 508.00797 513.70947 517.26086 520.14447 522.54022 524.99628 533.75867 536.23004 539.78143">If a memory operand effective address is outside the CS, DS, ES, FS, or GS segment limit.</tspan><tspan y="-327.96115" x="137.21968 141.00058 144.18478 147.00899 152.64838 157.99077 162.67076 166.21046 168.66656 174.30867 179.77257 183.31227 185.72697 191.18727 196.88878 199.71298 202.16908 206.84908 209.73268 212.14738 217.60768 222.28767 227.69127 231.23097 236.63367 242.18936 245.07297 247.48767 253.18918 256.07275 261.47635 264.30054 270.00201 275.46234 281.16382 285.12292 292.49933 296.34143 298.75613 302.29584 307.69855 313.10214 318.65784 321.11395 326.45636 329.28055 334.02084 339.36325 344.91895 353.68222 359.02463 364.7261 368.26581">If destination is located in a non-writeable segment.</tspan><tspan y="-313.98145" x="137.21968 140.99878 144.15688 146.98106 150.51717 156.20427 161.55836 164.44196 171.37106 177.43437 180.70047 183.52466 189.20276 195.26607 198.53217 201.41576 206.58086 212.64417 215.91026 218.79385 224.24695 228.08005 230.90424 237.86934 244.01544 246.83963 250.67273 256.07544 261.67255 264.12863 268.80774 272.34384 277.69794 281.53104 284.35526 286.81134 291.49045 294.37405 300.01614 304.69614 310.09885 315.67886 318.56247 322.09857 327.49948 330.38309 335.7822 340.4613 345.14041 350.49451 355.17361 359.85272 362.73633 371.48343 376.83752 385.58463 391.03772 394.87082 400.1889 403.07251 408.47162 414.15872 419.75583 422.58005 425.03613 428.57224 431.45584 436.13495 441.53586 447.22296 450.75906 456.15817 458.61426 464.30136 468.98047 471.80469 477.2038 480.0874 486.80951 493.3876 498.39072 503.39383 506.27744 510.95654 516.31067 521.90778 530.65491 536.05762 541.69971 545.23578">If the DS, ES, FS, or GS register is used to access memory and it contains a NULL segment </tspan><tspan y="-303.00143" x="136.91998 141.59819 146.95139 149.40659 154.75978 159.43799 162.97319 168.42538 171.00748">selector.</tspan><tspan y="-288.96143" x="45.119987 52.463989 58.52729 64.711189 68.789993 74.495995 137.25481 141.0258 144.1758 146.99998 152.39099 155.27458 164.01358 169.41628 178.15527 183.60028 187.42528 192.73528 195.61887 201.06387 206.70328 212.04927 215.71136 221.10237 226.78137 232.37038 235.25397 240.59996 243.74995 246.89995 252.24594 256.91693 260.44495 262.89294 268.11475 273.46075 276.34436 281.73535 287.33969 292.9404 296.7222 302.12491 306.80762 311.49033 314.31454 316.77423 321.45694 324.34055 329.74146 335.44296 338.98267 343.66537 346.12506 351.72577 357.12848 359.9527 363.4924 369.18311 374.5408 377.42441 383.4877 389.6113 392.43552 397.17581 402.51822 408.11893 416.86963 422.22733 427.91803 431.45773 434.28195 436.74164 439.20132 447.95203 450.34781 453.88751">#SS(0)If a memory operand effective address is outside the SS segment limit.</tspan><tspan y="-274.98172" x="45.119995 52.479294 58.758595 64.182892 68.26619 72.106491 76.792793 80.33609 85.796387 89.636688 94.32299 99.009293 104.61359 137.25299 141.03389 144.19919 147.02339 152.03369 154.85789 160.46219 162.92549 166.4688 169.3524 171.7491 177.45061 180.33421 183.87752 189.33781 194.55962 199.90201 205.59631 208.42052 214.02481 219.48511 224.84641 229.5327 232.3569 238.05121 243.51151 247.05481 249.93842 258.64142 264.04504 267.58835 272.27466 277.96896 280.85257 284.93588 288.72217 294.87546 300.59677 306.31808 312.0394 317.7247 322.897 328.58231 334.83459 338.10791 343.11823 350.70251 356.8558 359.73941 366.27972 369.10394 375.38324 381.44653 384.71985 389.73016 393.81348">#CP(rstorssp)If L bit in token does not match (IA32_EFER.LMA &amp; CS.L).</tspan><tspan y="-261.00201" x="137.2197 141.006 144.1713 146.9955 152.40179 158.00609 163.61038 167.45068 172.81198 177.49828 182.18457 185.06818 187.46487 193.16638 196.04999 199.59329 205.05359 210.27539 215.61778 221.31209 224.13629 229.74059 235.20088 240.56218 245.24847 248.07268 253.76698 259.22729 262.7706 265.65421 274.35721 279.76083 283.30414 287.99045 293.68475 296.56836 299.03165 301.42834 307.12265 312.48395 317.89026 321.73056 324.61417 330.02048 335.62479 341.2291 345.0694 350.43069 355.117 359.80331 362.62753 368.08783 371.25314 374.07736 382.83167 388.19296 396.94727 402.40756 406.24786 411.57315 414.39737 419.85767 425.46198 430.82327 434.48538 439.89169 445.586 451.19031">If address in token does not match linear address of memory operand.</tspan><tspan y="-246.96202" x="137.2197 141.0024 144.16409 146.9883 149.448 155.1387 157.96291 163.7256 169.42799 173.50769 179.1084 181.5681 185.1078 187.93201 193.3887 197.2254 200.10901 204.7917 210.2484 218.9991 224.59979 230.00249 233.54219 236.00189 241.6026 244.0623 246.459 248.9187 252.3981 257.71979 260.54401 269.29471 274.7514 280.35211 285.70981 288.53403 293.93674 299.62744 305.22815 308.11176 311.65146 317.34216 322.69986 325.52408 330.92679 336.5275 342.1282 345.9649 351.3226 356.00531 360.68802 363.57162 366.03131 371.72202 374.60562 378.14532 383.60202 388.82379 394.1662 399.8569 402.74051 405.13629 409.81631 412.69992 418.39062 423.84732 427.38702 430.21124 435.81195 441.21466 443.61136 449.07166 456.42737 459.25159 465.01431 471.9704">If in 32-bit or compatibility mode and the address in token is not below 4G.</tspan><tspan y="-232.98232" x="45.119995 52.470295 57.929699 63.092999 67.167297 70.323601 75.720901 81.406204 83.860504 87.220207 91.299011 95.976311 101.42761 107.02291 112.42561 137.26471 141.04561 144.2019 147.02609 152.42339 155.30698 160.90228 166.29958 171.89488 177.29758 180.12177 183.27806 188.67535 194.36066 196.81496 200.34926 203.23285 208.68414 213.36145 218.03876 223.72406 227.55536 232.23267">#PF(fault-code)If a page fault occurs.</tspan></text><text xml:space="preserve" transform="translate(0,792)" font-size="9.96" class="cC28FA1AE cD0BE81C2 c209E837B"><tspan y="-207.3" x="45.119999 51.298187 56.877781 62.179489 64.682434 67.753105 74.140457 79.7808 85.421143 88.843399 94.48275 99.222717 104.02245 106.48256 114.14479 119.78414 125.37469 131.01404 133.47417 139.05276 144.33556 148.71497 154.35432 159.75464 163.7755 166.25853 171.89789 177.60796">Real-Address Mode Exceptions</tspan></text><text xml:space="preserve" transform="translate(0,792)" font-size="9" class="c9256B18F cECB6486A"><tspan y="-192.96001" x="45.119999 52.437 59.037601 137.2224 142.7403 148.431 153.7887 156.67229 162.92099 169.07069 174.4086 181.48801 187.73671 193.80002 199.94972 205.37042 208.19461 210.65431 216.34502 221.02771 224.56741 228.40411 234.09482 238.77751 242.31721 244.71391 250.17421 255.86491 258.7485 261.1452 265.82523 268.70883 274.39954 279.84 283.3815 286.20572 290.04422 295.40372 300.08823 305.54672 311.14923 316.79132 319.25281 323.9292 329.2887 334.8912 337.77481 340.2363 345.87839 348.76199 352.60049 357.95999 363.3645 365.82599 369.7851 375.18872 380.79123 386.39374 390.23224 395.59174 400.27625 404.96075 407.84436 416.59686 422.05536 427.65787 433.01736 436.28888">#UDThe RSTORSSP instruction is not recognized in real-address mode. </tspan></text><text xml:space="preserve" transform="translate(0,792)" font-size="9.96" class="cC28FA1AE cD0BE81C2 c209E837B"><tspan y="-167.28" x="45.119999 51.591011 54.078022 57.700474 61.721329 67.435379 72.741074 75.248009 78.322662 84.445076 90.622269 96.744682 102.92188 105.382 113.04821 118.68757 124.2821 129.92146 132.38159 137.91637 143.19916 147.57857 153.21793 158.61824 162.6391 165.12611 170.76547 176.47952">Virtual-8086 Mode Exceptions</tspan></text><text xml:space="preserve" transform="translate(0,792)" font-size="9" class="c9256B18F cECB6486A"><tspan y="-153" x="45.119999 52.437 59.037601 137.2224 142.7403 148.4319 153.7905 156.67409 162.92369 169.0743 174.4122 181.49161 187.74121 193.80452 199.95512 205.37672 208.20091 210.66151 216.35312 221.03671 224.57732 228.41492 234.10652 238.79012 242.33072 244.72742 250.18771 255.87932 258.76294 261.15964 265.83963 268.72324 274.41483 279.87244 283.41302 286.23724 290.07483 295.43344 300.11703 305.57465 311.17624 316.81833 319.27893 323.95532 329.31393 334.91553 337.79913 340.25974 345.90182 348.78543 354.10803 356.50473 360.34232 363.8829 369.57449 374.97809 377.43869 381.51929 387.23788 392.95648 398.67508 404.39368 407.2179 415.96948 421.42709 427.02869 432.3873 435.6579">#UDThe RSTORSSP instruction is not recognized in virtual-8086 mode. </tspan></text><text xml:space="preserve" transform="translate(0,792)" font-size="9.96" class="cC28FA1AE cD0BE81C2 c209E837B"><tspan y="-127.32" x="45.119999 50.603973 56.19751 64.480247 70.093704 75.41832 79.408295 81.868416 87.508766 90.014702 92.540558 95.000679 99.02153 104.55531 107.07519 114.76032 120.35386 125.96732 131.56085 134.08073 139.63443 144.91721 149.35637 154.93596 160.39603 164.35712 166.86305 172.45659 178.18956">Compatibility Mode Exceptions</tspan></text><text xml:space="preserve" transform="translate(0,792)" font-size="9" class="c9256B18F cECB6486A"><tspan y="-112.98" x="45.119999 51.243599 56.647202 65.407799 70.750198 73.633804 79.046402 83.738998 86.563202 92.173805 96.020409 101.48701 105.03661 110.37901 115.05901 118.6086 123.951 129.5616 132.3858 141.14641 146.61301 152.19301 157.5354 160.41901 165.7614 170.9832 175.6758 181.01819 186.62878 190.17839 192.64799 198.11459 203.7567 208.43669">Same as protected mode exceptions.</tspan></text></g></svg><br/><br/><svg xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape" version="1.1" width="434.19501pt" height="149.76404pt" viewBox="0 0 434.19501 149.76404" sodipodi:docname="1307.svg" inkscape:version="0.92.5 (2060ec1f9f, 2020-04-08)"><metadata><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage" /></cc:Work></rdf:RDF></metadata><defs /><sodipodi:namedview pagecolor="#ffffff" bordercolor="#666666" borderopacity="1" objecttolerance="10" gridtolerance="10" guidetolerance="10" inkscape:pageopacity="0" inkscape:pageshadow="2" inkscape:window-width="640" inkscape:window-height="480" showgrid="false" inkscape:zoom="0.22348485" inkscape:cx="345.75164" inkscape:cy="-236.16414" inkscape:window-x="0" inkscape:window-y="0" inkscape:window-maximized="0" inkscape:current-layer="svg46" /><g transform="translate(-46.68627,-69.112849)" class="c9D877B2B"><text xml:space="preserve" transform="translate(0,792)" font-size="9.96" class="cC28FA1AE cD0BE81C2 c209E837B"><tspan y="-715.31989" x="46.02 52.164326 58.308651 61.405216 67.718857 70.227783 74.220749 76.68087 84.368996 89.965523 95.58197 101.1785 103.63862 109.1953 114.47809 118.8575 124.49686 129.89717 133.91803 136.42696 142.02348 147.75945">64-Bit Mode Exceptions</tspan></text><text xml:space="preserve" transform="translate(0,792)" font-size="9" class="c9256B18F cECB6486A"><tspan y="-700.97998" x="46.02 53.373001 59.952003 138.13681 141.91771 145.07671 147.90089 151.4379 157.1259 162.4809 165.36449 170.28749 177.3669 183.63989 189.86789 192.69208 198.33148 202.17358 207.52858 210.68758 213.08427 218.42578 221.30937 223.70607 228.38608 231.26967 236.95767 241.63766 246.99266 252.59067">#UDIf the LOCK prefix is used.</tspan><tspan y="-687.00031" x="138.11971 141.8907 145.0407 147.86488 154.12889 160.36589 166.07188 169.37398 175.63799 181.30798 186.83398 189.71758 197.06157 199.94516 205.65115">If CR4.CET = 0.</tspan><tspan y="-673.02063" x="138.11971 141.8907 145.0407 147.86488 154.12889 159.53789 164.58238 167.40657 174.75056 177.63416 183.34015 186.22374 191.61475 197.29375 202.88275 205.70694 209.47794 215.66273 221.36873 227.07472 232.83832 239.40833 245.17192 251.43593 257.10593 261.36472 264.60742 270.79224 277.50894 283.27252 289.39703 294.92303 301.14203 306.84802 312.51804 319.23203 322.11563 329.45963 332.34323 338.04922">If CPL = 3 and IA32_U_CET.SH_STK_EN = 0.</tspan><tspan y="-658.98065" x="138.11971 141.897 145.0533 147.87749 154.14778 159.56308 164.60667 167.43086 174.78116 177.66475 183.37704 186.26064 191.65793 197.34323 202.93854 205.76273 209.54002 215.72392 221.43622 227.14851 232.91121 239.05551 244.76781 251.0381 256.71442 260.97229 264.21411 270.39801 277.11383 282.82614 289.01004 294.54233 300.76764 306.47995 312.15625 318.87656 321.70078 329.05109 331.87531 337.63803">If CPL &lt; 3 and IA32_S_CET.SH_STK_EN = 0.</tspan><tspan y="-645.00098" x="46.020004 53.337002 60.293102 65.7174 69.800697 75.521996 138.1008 141.8871 145.0524 147.8766 150.3399 152.80321 158.44531 163.80661 169.21291 173.05321 175.87741 181.28371 186.888 192.49229 196.3326 201.69389 206.38019 211.06648 213.95009 219.41039 222.53429 225.41789 234.1722 239.53349 248.2878 253.6797 257.52359 262.85248 265.73608 271.19998 276.80789 282.17279 285.8349 291.24481 296.94272 302.55063 305.37485 311.07275 316.53665 320.08356 322.90778 328.63269 331.45691 337.06482 342.39371 345.94061 351.30551 354.12973 359.53964 362.00653 364.47342 370.08133 375.77924 381.14413 386.75204">#GP(0)If linear address of memory operand not 8 byte aligned.</tspan><tspan y="-631.0213" x="138.11971 141.90421 145.0677 147.89191 153.2964 156.18001 164.88301 170.28571 178.98871 184.44901 188.28751 193.61101 196.43521 201.89911 207.5016 213.1041 216.9426 222.30209 226.98659 231.67108 234.55469 237.01619 241.70068 244.52489 246.98639 252.67889 255.5031 260.90759 263.7912 269.4837 274.88461 280.57712 284.65863 289.34314 294.74765 300.44016 305.89865 311.59116 314.05264 318.73715 324.14166 326.53836 329.42197 332.58548 338.04398 341.88248 350.58548">If a memory address is in a non-canonical form.</tspan><tspan y="-616.98132" x="46.020004 53.371204 59.434502 65.579704 69.654907 75.368111 138.12692 141.90512 145.06232 147.88651 153.2847 156.16829 164.91449 170.31718 179.06339 184.51558 188.34778 193.66498 196.48917 201.95306 207.54927 213.14548 216.97768 222.33087 227.00908 231.68729 234.57088 238.40308 243.75627 246.91347 252.26666 256.09888 261.45209 267.13828 271.81647 274.27167 279.95786 285.55405 288.43765 291.97284 297.61493 303.01764 305.84186 311.90515 318.02875 320.91235 325.59055 330.94376 336.53995 345.28613 350.68884 356.33093 359.86612 362.74973 365.20493 369.88312 372.70734 375.16254 380.84872 383.67294 389.07114 391.95474 397.59683 403.05713 408.74332 412.81851 417.4967 422.8949 428.58109 434.03329 439.71948 442.17468 446.85287 452.25107 454.64777 457.53137 460.68857 466.14078 469.97299 478.71918">#SS(0)If a memory address referencing the SS segment is in a non-canonical form.</tspan><tspan y="-603.00165" x="46.020004 53.379303 59.658604 65.082901 69.166199 73.0065 77.692802 81.236099 86.696396 90.536697 95.223 99.909302 105.5136 138.153 141.9339 145.0992 147.9234 152.9337 155.7579 161.3622 163.8255 167.3688 170.25241 172.64911 178.35062 181.23422 184.77753 190.23782 195.45963 200.80202 206.49632 209.32053 214.92482 220.38512 225.74641 230.43271 233.25691 238.95122 244.41151 247.95482 250.83842 259.54141 264.94504 268.48834 273.17465 278.86896 281.75256 285.83588 289.62216 295.77545 301.49677 307.21808 312.93939 318.62469 323.797 329.4823 335.73459 339.00787 344.01819 351.60248 357.75577 360.63937 367.17969 370.00391 376.2832 382.3465 385.61981 390.63013 394.71344">#CP(rstorssp)If L bit in token does not match (IA32_EFER.LMA &amp; CS.L).</tspan><tspan y="-589.02197" x="138.11971 141.90601 145.0713 147.89551 153.3018 158.9061 164.51039 168.35069 173.71199 178.39828 183.08458 185.96819 188.36488 194.06639 196.95 200.4933 205.9536 211.1754 216.51779 222.2121 225.0363 230.64059 236.10089 241.46219 246.14848 248.97269 254.66699 260.12729 263.67059 266.5542 275.2572 280.66083 284.20413 288.89044 294.58475 297.46835 299.86414 302.32022 308.01453 313.37582 318.78214 322.62244 325.50604 330.91235 336.51666 342.12097 345.96127 351.32257 356.00888 360.69519 363.51941 368.97971 372.14502 374.96924 383.72354 389.08484 397.83914 403.29944 407.13974 412.46503 415.28925 420.74954 426.35385 431.71515 435.37726 440.78357 446.47787 452.08218">If address in token does not match linear address of memory operand.</tspan><tspan y="-574.98199" x="46.020004 53.370304 58.829708 63.993008 68.067307 71.22361 76.620911 82.306213 84.760513 88.120216 92.19902 96.87632 102.32762 107.92292 113.32562 138.16472 141.94562 145.10191 147.9261 153.32339 156.20699 161.80229 167.19958 172.79489 178.19759 181.02177 184.17807 189.57536 195.26067 197.71497 201.24927 204.13286 209.58415 214.26146 218.93877 224.62407 228.45537 233.13268">#PF(fault-code)If a page fault occurs.</tspan></text></g></svg>     <hr />     <p class="not_instruction_page">         This <b>UNOFFICIAL</b> reference was generated from the official <a href="https://www.intel.com/content/www/us/en/developer/articles/technical/intel-sdm.html">IntelÂ® 64 and IA-32 Architectures Software Developerâ€™s Manual</a> by a dumb script.         There is no guarantee that some parts aren't mangled or broken and is distributed <b>WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE</b>.     </p> </body>  </html>
