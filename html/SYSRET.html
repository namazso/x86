<!DOCTYPE html> <html lang="en">  <head>     <meta charset="utf-8">     <title>SYSRET</title>     <link rel="stylesheet" href="styles.css">     <link rel="stylesheet" href="../intel.css"> </head>  <body>     <svg xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape" version="1.1" width="512.28033pt" height="643.39343pt" viewBox="0 0 512.28033 643.39343" sodipodi:docname="1410.svg" inkscape:version="0.92.5 (2060ec1f9f, 2020-04-08)"><metadata><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage" /></cc:Work></rdf:RDF></metadata><defs /><sodipodi:namedview pagecolor="#ffffff" bordercolor="#666666" borderopacity="1" objecttolerance="10" gridtolerance="10" guidetolerance="10" inkscape:pageopacity="0" inkscape:pageshadow="2" inkscape:window-width="640" inkscape:window-height="480" showgrid="false" inkscape:zoom="0.22348485" inkscape:cx="347.84041" inkscape:cy="421.70165" inkscape:window-x="0" inkscape:window-y="0" inkscape:window-maximized="0" inkscape:current-layer="svg232" /><g transform="translate(-45.11969,-68.882812)" class="c9D877B2B"><text xml:space="preserve" transform="translate(0,792)" font-size="12" class="cA49CCA52 cD0BE81C2 c209E837B"><tspan y="-714" x="45.119999 51.6492 58.802399 65.461197 72.838791 79.556389 86.39399 96.173988 103.55159 110.11679 114.91799 121.75559 126.13799 133.03558 136.03558 142.69318 146.77557 153.49437 163.45317 166.45317 172.63077 179.04837 184.61757 189.41876 192.41876 198.94797 205.60556 211.17476 215.97595 222.69475 232.65355 235.65355 242.25595 248.61354 251.67354">SYSRET—Return From Fast System Call</tspan></text><text xml:space="preserve" transform="translate(0,792)" font-size="9.96" class="cC28FA1AE cD0BE81C2 c209E837B"><tspan y="-597.29999" x="235.2 237.83939 243.59726 248.27646 252.23755 255.89984 261.59796 266.17657 270.18747 272.64758 278.28693 283.98505 286.50494 293.15524 298.73483 304.34927 307.8313 313.1091 318.867 324.50137 326.96152 332.53613 338.29004 342.66946 348.28391 353.86349 356.39035 362.08847">Instruction Operand Encoding</tspan><tspan y="-539.33978" x="45.120377 51.602345 57.207832 61.986641 66.486572 70.1399 72.657791 78.117867 82.078964 84.596855 90.202347">Description</tspan></text><text xml:space="preserve" transform="translate(0,792)" font-size="9" class="c9256B18F cECB6486A"><tspan y="-522.96002" x="45.119999 51.267899 56.7948 62.942699 69.189598 74.869499 80.405403 83.229599 85.6875 90.368401 93.251999 98.652901 101.4771 106.158 111.6129 120.3618 125.9607 131.3616 137.05051 139.50841 144.9633 150.65221 153.47641 155.93431 161.62321 166.30411 169.84201 173.67691 179.36581 184.04672 187.58463 190.04253 195.49742 201.18633 204.01053 207.54843 213.00333 215.88693 219.42484 225.11374 230.46964 233.29384 239.44174 244.96864 251.11655 257.39044 263.53833 268.54324 273.54816 276.43176 278.88965 284.57855 289.25946 292.79736 296.63226 302.32117 307.00208 310.53998 312.99786 318.42029 324.11188 327.38248 330.26608 334.04968 337.59027 340.41449 344.25208 349.61069 353.21066 358.85275 362.69034 368.38193 373.06552 375.94913 379.07303 382.9151 388.37271 397.1243 399.94852 405.35211 411.0437 413.92731 421.00491 427.15552 430.03912 434.72272 440.00482 444.68842 448.229 453.58762 462.29059 466.37119 471.05478 476.45837 478.91898 481.37958 484.2038 489.89539 495.29898 500.99057 506.59216 509.05276 514.41138 518.24896 521.13257 524.67316 530.13074 532.95496 538.64655 543.33014 548.68872 552.52631">SYSRET is a companion instruction to the SYSCALL instruction. It returns from an OS system-call handler to user </tspan><tspan y="-511.98001" x="45.119995 49.790997 55.235996 60.824997 66.170998 68.694595 74.085594 77.613594 80.137192 85.776596 89.61869 92.066689 97.376686 99.824684 102.27268 107.61868 113.20769 118.61039 121.13399 123.58199 128.98468 134.20648 139.54887 141.99687 144.52046 150.22646 153.52855 156.05214 159.82314 163.35114 165.87473 171.46373 176.90874 182.25473 186.92574 189.44933 194.12033 199.56534 202.08893 207.67793 212.98793 215.51152 217.95952 223.43968 228.83607 234.43048 236.88388 242.56828 248.16269 250.68628 256.92868 260.70508 266.11948 268.64307 271.79846 275.62888 281.07928 289.82367 292.34726 298.58966 304.85907 311.01147 313.53506 318.93146 324.61584 330.21024 332.73383 335.18723 340.63763 346.03403 351.62842 354.08182 359.7662 365.3606 367.88419 374.12659 379.289 384.33261 390.45621 397.41861 403.60251 406.1261 409.28149 413.11191 418.56232 427.3067 429.83029 436.07269 441.78409 447.54678">code at privilege level 3. It does so by loading RIP from RCX and loading RFLAGS from R11.</tspan></text><text xml:space="preserve" transform="translate(0,792)" font-size="7.2" class="cB46BCADE cECB6486A"><tspan y="-515.58002" x="450.78">1</tspan></text><text xml:space="preserve" transform="translate(0,792)" font-size="9" class="c9256B18F cECB6486A"><tspan y="-511.98001" x="455.39999 457.92361 466.86603 469.26276 472.79346 478.47516 480.99878 486.39249 488.91611 494.62482 500.38751 504.45822 510.04993 512.50061 516.03131 518.55493 524.00262 529.5943 534.94299 538.66541 544.05908 549.74078 555.38019"> With a 64-bit operand </tspan><tspan y="-501" x="45.11969 49.79879 52.25489 56.870991 62.273689 65.539787 68.18399 74.330093 79.855194 86.001297 92.246399 97.9245 103.4586 106.1028 109.9359 115.29 124.0371 129.4362 131.8329 137.53441 142.2135 144.8577 147.3138 153.0009 155.58479 161.29889 167.06158 171.13768 176.73479 179.19089 182.72699 185.37119 194.11829 199.57138 205.16849 210.52258 214.59868 217.24287 222.64377 226.18347 231.87057 237.27327 241.10637 248.45847 250.91457 255.59366 260.94775 264.21387 266.79779 269.25388 272.78998 275.4342 280.7883 286.4754 290.01151 295.3656 299.1987 303.87781 306.47971 311.1561 316.60651 325.35089 330.94528 336.34167 339.87506 342.32846 347.92285 350.37625 352.82965 355.22635 358.75974 364.07513 366.71933 375.46375 380.91415 386.50854 391.85995 394.50415 399.90054 405.58493 411.17932 413.82352 419.27393 424.95831 427.41171 432.72711 435.37131 438.90469 444.5397 449.92349 452.50739 454.9635 460.4238 467.8056 470.3895 476.1333 481.83569 484.41959 490.04639 492.5025 496.0683 500.74829 503.33218 508.81497 512.00275 514.64697 518.21277 523.85486 529.23865 531.82257 535.68536 541.06915 546.64819 549.10425 553.78424">size, SYSRET remains in 64-bit mode; otherwise, it enters compatibility mode and only the low 32 bits of the regis-</tspan><tspan y="-489.95969" x="45.11969 48.656689 54.011688 57.845688 62.525688 65.409294 70.809296 74.643295 79.998299 82.822502 85.279503 90.733505 96.133507 101.73151 107.08651 112.68451">ters are loaded.</tspan><tspan y="-474" x="45.11969 51.26849 56.796291 62.945091 69.192894 74.873695 80.410492 82.694687 85.153488 90.609291 96.011093 101.61089 106.29269 108.63629 112.17509 117.8649 123.22169 125.50589 131.78069 137.92949 140.27309 145.67488 151.31699 156.91678 159.20097 165.26428 171.38788 173.73148 178.41327 183.77007 186.22887 191.58566 196.26746 199.80626 205.26205 209.09785 213.77965 216.06384 223.41864 225.87744 229.41624 235.05835 237.40195 242.50404 247.90764 250.36644 256.05624 261.41306 266.09485 268.43845 274.03824 279.39505 283.23083 285.68964 290.91144 296.21967 301.81406 304.09827 307.25366 311.08408 316.53448 325.27887 327.56308 333.15747 335.61087 339.14426 347.00394 352.71533 358.42673 362.50012 368.26282 373.96521 376.24942 381.69983 384.85522 387.13943 390.67282 396.35721 401.70862 404.05222 407.82861 413.97202 419.73471 425.44611 431.1575 437.3414 442.31931 448.4429 454.7402 457.02441 464.59882 470.78271 477.02512 480.28851 482.63211 489.37851 494.82892 502.17831 507.52972 512.75153 518.09393 520.67603 523.97815 526.26233 529.79572 535.4801 540.83148 543.11566 549.38507 555.52844">SYSRET loads the CS and SS selectors with values derived from bits63:48 of the IA32_STAR MSR. However, the CS </tspan><tspan y="-462.95969" x="45.119675 50.520576 56.209476 61.808376 64.632576 70.695877 76.879784 79.703979 85.302879 90.658783 95.339684 100.02058 103.85548 106.31339 111.91228 115.45019 120.90509 124.73999 127.56419 132.24509 137.64598 142.32687 148.01578 153.41847 158.09846 160.92267 166.32356 170.15846 175.51436">and SS descriptor caches are </tspan></text><text xml:space="preserve" transform="translate(0,792)" font-size="9" font-weight="bold" class="cC246365F c9256B18F c89C0ADDA"><tspan y="-462.95969" x="178.37997 184.73668 190.92058">not</tspan></text><text xml:space="preserve" transform="translate(0,792)" font-size="9" class="c9256B18F cECB6486A"><tspan y="-462.95969" x="195.05968 197.88388 200.33998 205.79308 211.19217 216.78928 222.14337 227.78278 230.60698 233.76508 237.59818 243.05127 251.79837 254.62257 258.15866 263.84576 269.19986 272.08347 277.68057 283.03467 287.71378 292.39288 296.22598 298.68207 304.27917 307.81528 313.26837 317.10147 321.78058 324.66418 328.7403 331.13699 336.8241 339.7077 346.67279 353.39758 358.93167 361.75589 367.20898 371.03937 373.92297 378.92789 385.65271 391.1886 395.26651 398.15012 401.98502 407.34091 410.50082 415.85672 419.69162 425.04752 430.73642 435.41733 440.77322 446.37213 449.19635 454.79526 460.11517 462.93939 466.47729 472.1662 477.62109 482.302 487.6579 490.5415 495.22241 500.57831 503.03619 508.39209 513.073 516.6109 522.0658 525.9007 530.5816 533.84949"> loaded from the descriptors (in GDT or LDT) referenced by those selectors. </tspan><tspan y="-451.97968" x="45.11969 48.897892 54.584091 59.262291 62.797493 68.150696 73.548897 79.145096 82.447197 85.2714 88.806602 94.492805 99.895508 102.71971 108.31591 113.71861 118.39681 123.07501 126.90721 129.30391 134.94331 138.47852 143.93071 147.76291 150.58711 155.26532 160.66351 165.34172 171.02792 176.38112 181.05933 183.94293 189.34113 193.17332 198.52652 201.41013 203.80682 209.26712 214.66531 220.30472 225.65791 231.25412 234.13773 241.48892 243.94412 247.47932 253.16553 255.98973 259.14694 261.60214 266.82394 272.16635 277.76254 280.64612 285.74823 291.15182 293.60703 299.29321 304.64642 309.29938 312.56729 315.39151 321.5394 326.89529 332.25119 335.1348 338.6727 344.3616 349.76431 352.58853 359.66342 365.26233 370.66504 374.32715 379.72806 383.26596 385.72385 391.17874 396.86765 399.75125 404.43216 409.78806 414.46896 418.00687 420.46475 425.91965 431.60855 434.43277 437.59268 443.04758 446.88248 449.7067 455.3056 460.6615 464.1994 469.60031 472.0582 474.45398 479.19427 482.4361 485.3197 489.10062 492.63852 495.46274 497.92062 502.60153 505.42575 508.96365 514.65253 520.00842 522.89203 526.72693 532.08282 536.76373 542.36261 547.8175 553.50641">Instead, the descriptor caches are loaded with fixed values. See the Operation section for details. It is the respon-</tspan><tspan y="-440.99966" x="45.11969 49.79969 52.256691 57.854691 60.311691 62.708393 65.16449 68.64389 73.98539 76.868996 82.322998 85.481995 88.365593 95.43959 101.58659 104.47019 109.15019 114.55109 117.7101 121.2471 128.5038 133.90739 137.74139 143.14409 145.96829 149.50529 154.95929 157.78349 163.18619 168.82829 173.5686 179.21071 183.04471 188.4474 191.27161 194.80861 200.49661 205.89661 209.43361 212.25781 215.79482 221.48282 226.88551 229.70972 235.30772 240.71042 245.39041 250.0704 253.9044 256.30109 261.94049 265.47748 270.93149 274.7655 279.4455 282.26968 286.34668 288.80368 294.49167 297.31586 304.28186 311.00665 316.54166 319.42523 324.87924 328.71326 331.53745 336.54144 343.26624 348.80124 352.87823 355.70242 359.53644 364.93915 368.09814 373.50085 377.28268 382.68539 388.37338 393.05338 398.40839 404.00638 406.88995 412.48795 417.80695 420.69052 424.22751 429.9155 435.36951 440.0495 445.40451 448.2287 452.90869 458.3114 460.7081 466.11081 470.7908 474.32779 479.7818 483.61581 486.44 491.6015 497.0051 499.4621 505.10419 510.5069 515.18689 518.01111 522.6911 528.14508 531.97906 535.81305 541.16803">sibility of OS software to ensure that the descriptors (in GDT or LDT) referenced by those selector values corre-</tspan><tspan y="-429.95935" x="45.11969 49.802391 55.403091 60.859791 66.550491 72.151192 75.03479 78.574493 84.031197 86.855392 90.395096 96.085793 101.4435 104.3271 107.48879 109.94849 115.1703 120.5127 126.1134 128.93761 134.09911 139.5027 141.9624 147.60451 152.9622 157.6449 160.4691 162.9288 168.3855 173.78819 179.38889 184.74658 190.34729 193.17149 195.6312 201.3219 204.8616 210.3183 213.1425 216.68221 222.37291 227.73061 230.61421 236.2149 241.5726 246.25529 250.93799 254.77469 257.23438 262.83508 266.37479 271.7757 275.6124 278.45999 283.1427 288.54541 293.22812 298.91882 304.27652 308.95923 313.03894 315.92255 319.46225 325.10434 330.50705 333.33127 339.48096 345.00964 351.15933 357.40802 363.08972 368.62741 371.51102 373.90771 379.60922 384.29193 387.83163 391.66833 397.35904 402.04175 405.58145 408.04114 413.49783 419.18854 422.01276 427.61346 433.07016 438.47287 443.15289 445.97711 451.66782 457.12451 460.66422 463.48843 468.89114 474.59265 479.27536 484.91745 488.75415 494.15686 496.98108 500.52078 506.21149 508.67117 513.35388">spond to the fixed values loaded into the descriptor caches; the SYSRET instruction does not ensure this </tspan><tspan y="-418.97934" x="45.11969 49.796989 55.248291 59.07959 62.910889 68.263191 72.940491 78.535789 83.987091 89.672394 95.267693 100.67039 106.3557 111.033 116.3853">correspondence.</tspan><tspan y="-402.95935" x="45.11969 50.646591 56.326492 61.673393 63.957596 70.096497 75.674698 81.813599 88.051498 93.722397 99.249298 101.5335 103.9824 109.6623 114.3342 117.9342 121.76009 127.43999 132.11189 135.64079 138.08969 143.5356 149.2155 151.49969 157.0896 162.53551 167.8824 172.55431 174.8385 180.5184 185.96431 189.49321 191.7774 200.5173 205.96321 211.60262 213.99931 217.15021 222.4917 224.75967 228.30028 233.99188 239.35048 241.63467 246.31827 249.85887 255.26247 259.94608 265.26868 267.55289 273.15448 278.55539 281.01599 286.70758 290.24817 295.60678 299.44437 301.72858 305.80917 311.49176 317.64236 323.06396 325.28787 330.74548 334.58307 336.86728 343.11688 349.26749 354.68909 358.76968 362.04028 364.32449 369.30688 374.76718 378.60477 380.82867 384.36926 390.06085 395.46445 399.00504 401.28925 405.12683 410.48544 415.88904 420.57263 426.03024 431.72183 434.99243 437.21634 439.67694 443.21753 445.50174 447.96234 452.64594 454.93015 460.57224 465.97495 470.65854 476.01715 480.70074 485.38434 490.78793 494.62552 499.94812 502.23233 505.39493 510.85254 514.69012 516.9743 521.6579 527.11548 530.27808 533.81866 541.07538 546.479 550.31659 555.67517">The SYSRET instruction does not modify the stack pointer (ESP or RSP). For that reason, it is necessary for software </tspan><tspan y="-391.97934" x="45.11969 48.653091 54.103493 56.387691 61.064091 68.41349 70.86689 74.400291 79.076691 84.761093 87.045296 90.578697 96.029099 98.313301 101.8467 107.53111 112.88251 115.16671 120.85111 125.52751 130.87891 134.7093 136.9935 141.73381 145.27351 150.66991 155.34631 160.66171 163.96381 166.248 171.7794 177.46381 182.8152 185.0994 192.1698 198.3537 200.63789 209.38229 214.77869 220.09409 222.37828 224.83168 230.28207 235.67847 241.27287 243.55707 247.09047 252.77487 258.12628 260.41049 266.09488 270.77127 276.12268 279.95309 282.2373 286.9776 290.45969 295.84979 300.5199 305.82901 308.11322 313.75262 319.21292 321.66003 327.33813 330.86523 336.21033 340.03442 342.31863 346.38574 348.83286 352.01706 354.30127 356.74838 360.27548 362.55969 369.81641 375.22 379.89011 382.17432 386.84442 392.23453 397.45633 402.79874 408.43814 410.72235 416.11246 419.29666 422.82376 428.16885 431.99295 434.27716 440.41425 445.99246 452.12958 458.42776 464.56488 469.55899 474.6026 478.6814 480.96561 486.55371 491.95639 495.1055 500.54959 504.37369 509.71878 512.06232 517.40741 522.62921 527.9743 532.64441 538.32251 541.84961 544.29669 549.97479 555.61414">to switch to the user stack. The OS may load the user stack pointer (if it was saved after SYSCALL) before executing </tspan><tspan y="-380.99933" x="45.11969 51.265789 56.79089 62.936989 69.182091 74.860191 79.478096 83.554199 85.838394 91.237495 93.693596 97.229698 102.5838 106.4169 112.104 117.50311 121.03921 123.49531 128.71712 134.11981 136.51651 141.01831 144.3204 146.6046 152.2917 156.97079 162.32489 166.15799 168.44218 173.12128 178.57437 184.17148 189.57417 191.85837 200.60547 205.94876 211.26686 213.55106 216.00716 221.46025 226.85934 232.45645 234.74065 238.27675 243.96385 249.31795 251.66154 256.34064 259.87674 265.27585 269.95496 275.27307 277.55728 283.15439 288.60748 291.00418 296.70569 300.24179 305.6445 309.4776 311.76181 315.83792 318.23462 321.39273 323.67694 326.13303 329.66913 331.95334 339.21005 344.61365 349.29276 351.57697 356.25607 361.5994 366.91748 372.27158 377.86868 380.15289 385.75 391.1041 394.26221 399.7153 403.5484 408.9025 411.18671 417.33279 422.91098 429.05707 435.32916 441.47525 446.47836 451.48148 455.55759 457.8418 463.24091 466.39902 469.93512 475.28922 479.12231 481.40652 485.23962 490.59372 495.27283 500.67554 503.13162 508.44971 510.90579 516.5929 522.19 524.47418 529.15326 534.60638 540.29346 543.82953 547.66266 553.11578 555.5719">SYSRET; alternatively, user code may load the stack pointer (if it was saved before SYSCALL) after receiving control </tspan><tspan y="-369.95901" x="45.11969 48.293991 52.143291 57.544189 66.307487 69.191086 75.31469 80.832588 86.994888 93.256187 98.892883 103.15079">from SYSRET.</tspan><tspan y="-353.99933" x="45.11969 48.90329 52.065891 54.890091 58.430691 64.122292 69.480888 72.364487 79.442085 85.592682 88.416878 90.87748 96.335083 101.73869 107.34029 112.08059 114.90479 118.44539 124.13699 129.49559 132.3792 137.06279 140.60339 146.00699 150.69058 156.01318 158.89679 164.49838 169.95598 172.41658 178.10818 181.64879 187.00739 190.84499 193.66919 199.27078 204.62938 207.79198 213.24957 217.08717 222.44577 225.26997 230.62857 235.79007 241.14867 245.83226 251.52386 255.06447 257.46115 263.16263 268.76422 271.58841 277.73901 283.31723 289.46783 295.71744 301.40002 305.65793 308.92853 311.8121 314.27271 317.81329 320.63748 329.38907 335.08066 339.76425 343.30484 346.12903 351.48764 357.17923 361.86282 367.55441 371.392 376.75061 379.63419 383.17477 388.86636 394.26996 397.81055 400.63474 404.17532 409.86691 415.22552 418.1091 423.80069 429.20428 434.84637 440.48578 442.88159 448.2843 452.12189 454.94608 460.40369 463.56628 466.39047 471.79407 477.43616 482.75876 485.64233 488.03815 493.73962 497.28021 502.63882 506.47641 510.314 515.95612 521.55774 525.09833 527.92255 533.38013 537.21771">If the OS loads the stack pointer before executing SYSRET, it must ensure that the handler of any interrupt or </tspan><tspan y="-342.95901" x="45.11969 50.471092 55.69289 60.369289 65.771988 71.366386 74.899788 77.353188 82.803589 88.487991 90.831596 96.425995 101.7774 104.2308 106.6842 111.906 117.3087 121.0905 126.4932 132.0732 134.35739 139.9968 145.33919 148.87259 156.22198 161.57338 166.92477 172.60918 174.89337 178.72377 184.12646 188.80287 192.33627 197.78667 201.61707 204.07047 209.75487 215.34927 217.69287 221.22627 226.91068 232.26207 234.54626 239.22267 242.75607 248.15247 252.82887 258.14429 260.4285 266.0679 271.5282 273.9816 279.66599 283.19937 288.60208 292.4325 294.71671 300.1131 305.79749 311.39188 313.61938 318.29758 323.98376 328.66196 333.34015 338.74286 343.42105 348.09924 351.25644 356.94263 359.39783 361.68204 367.08475 372.30655 377.65976 382.33795 388.02414 391.55933 393.95602 399.41632 405.10251 407.44611 412.89832 416.05551 418.39911 424.54431 430.06851 436.21371 442.45792 448.13513 453.66833 455.95255 458.40775 463.08594 465.37015 471.05634 476.50854 480.04373 482.32794 484.78314 490.36493 495.68213 501.13434 506.35614 511.69855 517.29474 519.63837 526.98956 529.44476 532.97998 538.6662 540.95044 544.48566 550.17188 555.52509">exception delivered between restoring the stack pointer and successful execution of SYSRET is not invoked with the </tspan><tspan y="-331.979" x="45.11969 50.80949 55.491291 60.848091 64.683891 67.508087 72.189888 75.728691 81.130493 85.870796 91.191597 94.460396 97.284592 101.06639 104.60519 107.48879 112.17059 117.5724 123.26219 126.08639 131.68619 137.14198 140.02559 144.70738 150.16318 152.98738 158.67719 163.35898 165.81778 171.50758 177.10739 179.93159 185.33339 190.9332 196.53299 200.36879 205.82458 211.22638 215.90817 221.59798 226.95477 231.63657 234.52017 239.20197 244.89177 249.57356 255.21567 258.09924 263.50104 268.18283 271.00702 274.54581 280.2356 285.59241 288.47598 291.63678 297.09259 299.48929 301.9454 307.40121 314.75601 317.15271 322.85419 328.45398">user stack. It can do so using approaches such as the following:</tspan></text><text xml:space="preserve" transform="translate(0,792)" font-size="13.98" class="c226444D3 c9DBAE658"><tspan y="-316.98001" x="45.119999">•</tspan></text><text xml:space="preserve" transform="translate(0,792)" font-size="9" class="c9256B18F cECB6486A"><tspan y="-316.98001" x="62.099998 67.774498 73.088997 76.621498 81.972 85.801498 91.485001 96.880501 99.277199 102.1608 104.6133 110.29681 113.82931 119.23201 123.06151 126.89101 132.57451 138.21391 141.75362 146.42912 149.69162 152.57521 158.10571 163.78922 169.13971 172.0233 179.0928 185.23531 188.05949 192.7998 198.20341 203.88692 206.77051 212.36401 216.19351 221.54401 226.85851 232.209 237.8925 241.425 244.24919 249.64468 255.32819 258.21179 263.56229 268.8768 272.4093 277.7598 281.58929 287.2728 292.6683 295.06503 297.89999 300.34891 306.02881 309.55771 314.96039 318.78629 322.61218 328.29208 333.93149 337.47119 340.29541 343.44632 347.27222 352.71811 361.45801 364.28223 369.87213 375.27481 377.72372 383.40363 389.04303 391.86725 397.45715 402.85983 405.30875 407.75766 412.97946 418.38214 422.20804 427.55493 433.14484 436.02844 441.61835 446.92926 449.81287 454.48477 456.93369 462.28058 467.67249 471.49838 473.9473 479.6272 485.2171 488.04132 493.71222 498.87012 503.91373 510.03732 516.99524 523.05853 526.36066 530.14154 535.29944">External interrupts. The OS can prevent an external interrupt from being delivered by clearing EFLAGS.IF </tspan><tspan y="-306" x="62.099991 67.69619 73.049393 76.206596 81.607498 85.439697 90.8424 93.666603 96.121803 101.57401 106.97221 112.56841 115.02361 120.70981 126.30601 129.18961 132.72481 138.41101 143.81371 146.63789 152.3241 157.0023 162.3555 166.1877 169.07129 173.7495 177.2847 182.68289 187.3611 192.6783 195.56189 201.1581 206.61029 209.06549 214.75169 218.2869 223.64009 226.22218">before loading the user stack pointer.</tspan></text><text xml:space="preserve" transform="translate(0,792)" font-size="13.98" class="c226444D3 c9DBAE658"><tspan y="-291" x="45.119999">•</tspan></text><text xml:space="preserve" transform="translate(0,792)" font-size="9" class="c9256B18F cECB6486A"><tspan y="-291" x="62.099998 68.823898 74.278801 79.967705 88.716606 94.117508 98.798409 104.11831 109.58221 115.18111 117.63902 122.99492 125.81911 128.27701 133.96591 137.50381 142.85971 146.69461 150.52951 156.21841 161.81732 165.35522 170.03613 172.91974 176.99763 183.72154 191.30045 195.08134 199.76224 203.84013 207.10803 209.93224 215.46814 221.15704 226.55974 229.38394 236.45885 242.60675 245.49036 250.17126 255.57216 261.26105 264.08527 269.44116 275.13007 279.81097 285.49988 289.33478 294.69067 297.57428 301.11218 306.80109 312.202 315.7399 318.48032 322.02002 327.71072 333.06842 335.95203 342.67773 350.25842 354.04114 356.92474 362.56683 367.97043 373.66113 379.26184 381.65854 387.06125 390.89795 393.72217 396.18185 400.86456 403.68878 406.14847 411.73029 417.05197 422.50867 427.73044 433.07285 438.67355 441.55716 448.91287 451.37256 454.91226 460.60297 463.42719 466.96689 472.65759 478.01529 480.83951 485.52222 490.97891 494.81561 498.65231 504.01001 508.69272 512.23242 515.11597 519.79865 523.33832 528.74103 533.42371 538.74542 541.56958 547.17029 552.492">Nonmaskable interrupts (NMIs). The OS can ensure that the NMI handler is invoked with the correct stack by </tspan><tspan y="-279.95969" x="62.100006 67.785309 72.462608 74.916908 80.602211 86.19751 89.021713 92.556015 98.241318 103.64402 106.46822 108.92252 114.60783 118.14213 123.49443 127.32573 131.15703 136.84233 142.43764 145.97194 148.79613 153.47343 157.00774 162.40503 167.14534 172.46164 175.34523 178.87953 184.27682 189.87213 192.32643 197.67873 200.56232 204.63661 208.41391 214.55821 220.09052 224.16481 227.0484 235.7937 241.146 245.8233 251.50861 256.90591 262.59122 265.04553 269.72284 278.46814 281.35175 284.50806 289.95935 293.79065 296.67426 302.26956 307.66687 311.20117 316.50031 319.3848 325.09711 327.92221 331.99652 338.71683 346.33981 350.12161 354.19592 357.02103 359.47534 365.16064 367.98575 371.52005 377.20535 382.55765 385.44214 389.21945 395.94516 401.47745 404.36194 408.43625 413.11356 418.46585 423.81815 426.70264 432.84692 438.19922 442.87653 446.41083 448.86514 454.31644 460.00174 462.82684 468.59045 471.83316 477.54547 483.30908 486.57339 492.33701 495.60132 498.42642 502.54572 506.32303 512.0083 515.5426 520.8949 524.7262 528.5575 534.2428 539.88306 543.42365">using the interrupt stack table (IST) mechanism for gate 2 (NMI) in the IDT (see Section 6.14.5, “Interrupt </tspan><tspan y="-268.97968" x="62.100006 68.258705 71.807404 77.219101 81.910797 87.192902 90.0765 94.574699 99.978294 105.5583 108.01439 113.35679 115.69859 119.83229 122.65649 125.12518 130.82489">Stack Table,” in </tspan></text><text xml:space="preserve" transform="translate(0,792)" font-size="9" font-style="italic" class="cAFCCD1DD c9256B18F c0F4078D5"><tspan y="-268.97968" x="133.6203 137.3967 143.0811 146.6145 152.0172 154.4706 163.45799 166.34158 172.05298 177.76437 180.64796 186.04436 191.72876 197.32317 200.14735 203.92375 210.10765 214.18105 219.89244 225.60384 228.48743 234.62183 238.45222 243.12863 248.81303 251.26643 254.79984 260.15125 264.82764 268.36102 274.04541 277.87582 283.22723 287.90363 290.7872 296.9306 302.38101 305.53641 309.06979 316.41919 321.81558 325.646 330.99741 333.82159 340.703 346.05441 351.36081 356.71222 359.16562 364.61603 370.21042 375.61313 379.44354 381.85193 386.52832 389.35251 396.97461 402.3782 408.06259 413.74698 419.14337 421.59677 424.89886 427.72305 433.90695 439.36725 441.82065 447.50504 456.24945 461.65216 464.47635 470.18774">Intel® 64 and IA-32 Architectures Software Developer’s Manual, Volume 3A</tspan></text><text xml:space="preserve" transform="translate(0,792)" font-size="9" class="c9256B18F cECB6486A"><tspan y="-268.97968" x="476.34033 480.41913">).</tspan></text><text xml:space="preserve" transform="translate(0,792)" font-size="13.98" class="c226444D3 c9DBAE658"><tspan y="-253.98" x="45.119999">•</tspan></text><text xml:space="preserve" transform="translate(0,792)" font-size="9" class="c9256B18F cECB6486A"><tspan y="-253.98" x="62.099998 69.074097 74.437195 80.079292 85.481987 89.144089 94.547684 97.012787 101.09789 106.70399 110.54609 116.00819 119.55328 124.91638 129.60448 133.14958 135.61469 141.07678 146.77289 149.59709 154.96019 160.18199 164.87009 170.23318 175.83928 179.38438 181.84949 187.31158 193.00769 197.69579 200.51999 204.60509 211.96619 218.94029 224.36639 228.45149 231.72659 234.5508 240.0939 245.73601 251.09911 253.92331 260.0784 265.61249 271.76758 278.02167 283.70877 289.25186 292.13547 294.53217 300.23367 304.92178 308.34 312.16949 317.853 322.5285 326.061 328.51352 333.96301 339.64651 342.47073 348.06424 353.46692 359.15042 364.50092 368.16302 373.56662 377.09912 382.44962 387.12512 390.00873 397.35724 404.37363 409.78714 413.85965 419.57016 423.64267 426.52628 428.923 432.10721 434.99081 438.52332 444.20682 449.6095 452.43372 457.59521 462.99881 465.45132 471.13483 476.53751 479.36172 484.81122 487.96573 490.78995 497.03143 503.29993 509.45142 512.33496 514.78748 519.46295 522.28711 527.97058 533.4201 536.95258">General-protection exceptions (#GP). The SYSRET instruction generates #GP(0) if the value of RCX is not </tspan><tspan y="-243" x="62.099991 66.781792 72.183594 77.873398 83.329201 89.018997 91.477798 96.159599 101.5614 103.9581 107.2602 110.0844 115.6212 121.311 126.7137 129.5379 136.61371 142.76251 145.58672 150.26851 155.6703 161.36011 164.18431 169.58611 175.18591 180.78571 184.62151 189.9783 194.6601 199.34189 202.22549 205.7643 211.4541 213.8508 218.53079 221.4144 227.01419 232.46999 237.15178 241.83357 244.29237 249.89218 252.35098 254.80978 257.26859 260.74799 266.06879 268.95236 274.64215 279.29968 281.76477 287.46088 293.06699 295.8912 301.3533 307.04941 312.41251 315.29611 320.75821 324.60031 327.42453 336.18063 341.64273 345.48483 350.84793 353.67215 359.13425 362.30136 365.12558 368.67068 374.36679 379.7695 382.59372 385.76083 391.22293 393.61871 396.0748 401.5369 408.89801 411.29471 416.99622 422.60233 425.42654 430.83466 436.44077 442.04688 445.88898 451.35107 456.75919 461.4473 467.1434 472.54611 477.22614">canonical. The OS can address this possibility using one or more of the following approaches:</tspan><tspan y="-226.98" x="62.099976 79.139671 85.377571 90.831573 96.519577 99.678574 102.07527 105.90927 114.65727 117.11427 122.80228 128.40028 131.22449 134.76149 140.44949 145.84949 149.38649 152.2701 155.8071 161.4951 166.8501 169.6743 174.8358 180.2394 182.6964 188.3844 193.7394 196.5636 202.01759 205.17659 208.00079 214.2981 220.536 226.692 229.5162 231.97321 236.6532 239.4774 244.15741 249.5574 255.24541 260.6994 266.38739 268.84439 273.52438 278.92438 281.38138 284.20557 289.80356 295.20627 298.36526 303.81927 307.65329 313.056 315.88019 321.2352 326.457 331.81201 336.492 342.17999 345.71698 348.17398 353.86197 359.45996 362.34354 368.49054 374.01654 380.16354 386.40955 392.08853 396.34644">—Confirming that the value of RCX is canonical before executing SYSRET.</tspan><tspan y="-210.95999" x="62.099976 79.139679 85.679985 90.363586 92.824188 98.515785 104.11739 107.00098 112.60258 118.00619 123.60779 126.06839 131.75999 137.3616 140.24521 143.78581 149.24341 152.06761 157.42621 163.11781 167.80141 173.49301 177.33061 182.68921 185.57281 189.11342 194.75552 200.21942 203.75912 206.58333 210.12393 215.81554 221.17413 224.05774 230.20834 235.73795 241.88855 248.16515 254.31575 259.32336 264.33096 267.15515 269.61575 275.30734 279.99094 283.53152 287.36911 293.0112 297.69479 301.23538 303.69598 309.15359 314.84518 317.66937 325.02597 327.48657 329.88327 332.33939 335.22296 340.86505 346.26776 351.48956 356.83197 360.66956 363.55313 368.23672 373.58002 378.80182 384.14423 387.0278 392.4314 395.25558 400.94717 406.40479 412.09637 416.17697 420.86057 426.26416 431.95575 437.41336 443.05545 445.51157 450.19516 455.59875 458.05936 460.88354 466.04504 471.44864 473.90924 479.60083 484.95944 487.78363 490.24423 495.93582 499.47641 504.93402 507.75821 514.00781 520.28442 526.44403">—Using paging to ensure that the SYSCALL instruction will never save a non-canonical value into RCX.</tspan><tspan y="-195.00029" x="62.099976 79.139679 85.679977 90.36628 92.829582 98.52388 104.12818 107.01178 110.55508 116.19717 121.55847 124.38267 128.16896 134.32227 139.86357 142.68777 151.44208 156.80338 161.48967 167.18398 172.59027 178.28458 180.74788 185.43417 194.18848 197.01268 200.17798 205.63828 209.47858 212.30278 217.90707 223.31337 226.85667 232.21797 235.04218 240.76347 246.48477 249.30898 253.39227 260.75159 267.72388 273.14816 277.23148 280.11508 282.51178 288.21329 291.09689 294.6402 300.3345 305.6958 308.52002 312.3063 319.03113 323.28903">—Using the IST mechanism for gate 13 (#GP) in the IDT.</tspan><tspan y="-178.98029" x="45.119675 54.007175 59.690674 65.041176 70.724678 73.128578 77.804077 83.487579 88.88308 94.476578 99.926079 107.27458 109.67848 114.35398 117.88648 123.28198 128.02228 133.33678 138.01228 140.41618 145.81168 149.64117 154.99167 157.39557 162.79826 168.44037 173.83588 179.47528 181.87198 187.27467 192.86818 195.27208 200.66757 204.20007 206.60397 212.19748 216.02698 218.47948 223.79398 226.19067 228.64677 233.99727 239.63667 244.98717 247.39107 249.84357 255.19406 260.41586 265.81854 268.21527 270.61917 276.32968 278.73358 282.26608 287.94958 293.30008 295.67969 298.14117 303.83368 308.51819 312.05969 315.89819 321.5907 326.27521 329.81671 332.2782 337.67911 343.37161 345.77551 348.237 353.6955 359.10001 364.70251 369.38702 371.79092 377.85422 383.97781 389.4003 391.8042 399.16171 401.6232 405.1647 410.85721 413.26111 418.36319 423.76682 426.2283 431.92081 437.2803 439.6842 442.84772 446.68622 452.14471 460.89722 463.24081 467.02533 473.17682 478.89633 484.61584 490.37857 495.80106 500.80957 506.5723 512.27472 518.33801 524.46161 529.88409 532.28802 539.87054 546.02203 552.27252 555.54401">When shadow stacks are enabled at privilege level 3 the instruction loads SSP with value from IA32_PL3_SSP MSR. </tspan><tspan y="-168.00029" x="45.11969 51.11729 56.519993 59.682594 65.041191 68.878792 71.222389 74.762993 80.220596 82.624496 88.9011 94.543198 99.9468 105.5484 109.089 114.4476 118.2852 120.6891 126.4077 129.6783 132.0219 136.14749 141.56909 145.40669 150.86429 155.54788 160.90648 166.50809 172.19969 176.03729 181.39589 183.79979 190.07639 195.47998 197.94058 200.40118 205.08478 208.35538 210.71968 214.49428 220.17688 223.70848 229.05807 232.88667 236.71527 242.39787 247.99048 251.52208 256.19669 259.49878 261.90268 267.29727 272.97986 278.57245 280.97635 286.64996 291.87177 296.54636 301.94907 307.54166 311.07324 313.52484 318.97345 324.65604 329.33063 333.44724 335.85114 341.24573 346.92831 352.5209 354.9248 361.19241 366.875 372.26959 377.909 381.44058 386.81998 390.65488 393.05878 398.77469 404.4906 407.79272 410.19662 414.31952 420.59341 426.04831 431.73721 435.27512 439.11002 444.56491 446.96161 451.03952 456.20642 458.66431 464.1192 471.47311 473.81671 479.49661 485.18552 488.34543 493.80032 497.63522 502.37552 507.73141 516.48029 521.83618 527.52509 531.06299 533.40662 538.02448 543.36688 548.04779 553.73669">Refer to Chapter 6, “Procedure Calls, Interrupts, and Exceptions” and Chapter 18, “Control-Flow Enforcement Tech-</tspan><tspan y="-156.95999" x="45.119659 50.80946 56.265259 58.661961 64.122261 69.722061 75.042862 77.74646 81.825256 88.10006 93.780861 99.317657 103.39645 107.52026 110.16445 112.62325 118.31305 120.95724 124.55725 130.19936 135.60205">nology (CET)” in the </tspan></text><text xml:space="preserve" transform="translate(0,792)" font-size="9" font-style="italic" class="cAFCCD1DD c9256B18F c0F4078D5"><tspan y="-156.95999" x="138.23996 142.01816 147.70436 151.23956 156.59276 159.04796 168.03716 170.74075 176.45395 182.16714 184.87074 190.26894 195.95514 201.59454 204.23874 208.01694 214.19994 218.27513 223.98833 229.70152 232.40512 238.54132 242.37352 247.05173 252.73793 255.19313 258.72833 264.08154 268.75974 272.29492 277.98111 281.81332 287.16653 291.84473 294.54831 300.69351 306.14572 309.30292 312.8381 320.1893 325.58749 329.41971 334.82242 337.46661 344.34982 349.70303 355.01123 360.36444 362.81964 368.27185 373.86804 379.22125 383.05347 385.51764 390.19583 392.84003 400.46213 405.86572 411.55191 417.2381 422.63629 425.09149 428.39359 431.03778 437.22079 442.6217 445.13809 450.78018 459.52637 464.87958 467.58316">Intel® 64 and IA-32 Architectures Software Developer’s Manual, Volume 1</tspan></text><text xml:space="preserve" transform="translate(0,792)" font-size="9" class="c9256B18F cECB6486A"><tspan y="-156.95999" x="473.15964 475.86322 479.01141 484.45462 488.27783 490.98141 496.37061 501.95779 507.54498 509.99118 513.5174 515.96362 521.4068 527.10828 532.4975 534.94373 537.64734 543.90955 549.60657 555.13074"> for additional CET </tspan><tspan y="-145.98" x="45.119629 50.714027 56.06543 59.598831 64.995232 67.448631 69.902031 74.57843">details.</tspan></text><text xml:space="preserve" transform="translate(0,792)" font-size="9" class="c9256B18F cD0BE81C2"><tspan y="-685.01965" x="48.77993 54.73793 59.777931 63.797329 68.777031 73.877335 147.73674 150.12173 155.26973 159.46912 163.07001 166.328 171.476 175.6151 179.1557 181.43539 186.4745 259.97211 265.97153 271.01154 274.43155">OpcodeInstructionOp/ </tspan><tspan y="-674.99994" x="259.98022 264.95901">En</tspan><tspan y="-685.01965" x="284.75992 290.27603 295.79214 298.55426 304.22336 306.50308 310.0752">64-Bit </tspan><tspan y="-674.99994" x="284.75992 291.67282 296.69571 301.7366">Mode</tspan><tspan y="-685.01965" x="332.75961 337.7258 342.70547 350.20068 355.24066 360.06287 363.67908">Compat/</tspan><tspan y="-674.99994" x="332.75961 337.20023 342.23932 347.2793 349.4996 356.45929 361.43896 366.53925">Leg Mode</tspan><tspan y="-685.01965" x="379.4993 385.3331 390.37491 394.66971 398.77551 402.05331 404.30511 409.16513 412.76602 415.01782 420.05963">Description</tspan></text><text xml:space="preserve" transform="translate(0,792)" font-size="9" class="c9256B18F cAF7646FE"><tspan y="-659.99963" x="48.778992 54.010693 58.751892 60.971294 66.202995 147.743 152.36539 157.34688 162.09258 167.55199 172.24368 260.02249 265.00128 284.7995 290.08069 294.57977 296.47247 298.39218 332.77127 334.87186 339.49426 343.99335 348.43304 350.32574 352.30756 379.48666 384.76608 389.267 392.6087 397.4111 400.64481 405.3905 407.60989 410.9516 415.61899 417.83838 421.49777 426.23898 433.16898 437.84808 442.10776 445.52774 447.46274 452.14185 454.07684 455.98483 457.96664 461.32632 465.98831 468.2077 475.1377 479.8447 484.5238 489.20471 491.4241 494.78293 497.84473 502.58594 509.48624 511.70563 515.06439 519.56354 523.46503 526.82471">0F 07SYSRETZOValidInvalidReturn to compatibility mode from fast </tspan><tspan y="-649.01965" x="379.4993 383.46109 388.14108 392.04257 395.40228 400.11557 407.06088 409.2803 413.18359 417.6539 419.57721 421.50052">system call </tspan><tspan y="-634.01935" x="48.778992 54.20779 58.888691 64.551491 66.26329 73.57309 75.792488 80.969292 83.18869 88.45549 93.136391 95.355789 100.62259 147.72319 152.3456 157.3271 162.06921 167.52861 172.20952 259.98834 264.96713 284.76532 290.04651 294.54559 296.47339 298.3949 332.77399 334.87457 339.49698 343.99609 348.43579 350.3573 352.3121 379.49118 384.77057 389.27148 392.64828 397.42908 400.69788 405.43997 407.65936 410.95966 415.64056 417.85995 423.12677 428.39355 431.23035 435.89413 437.81564 441.19244 443.41183 450.36163 455.04254 459.70633 464.42413 466.64352 469.9429 473.065 477.74591 484.70651 486.9259 490.22528 494.72437 498.62589 501.9856 504.20499 508.16681 512.84686 516.74835 520.10803 524.78888 531.74951 533.96893 537.87671 542.3515 544.2793 546.20709">REX.W + 0F 07SYSRETZOValidInvalidReturn to 64-bit mode from fast system call </tspan><tspan y="-583.01904" x="55.49929 61.257492 65.877197 68.995705 73.7369 124.4393 130.19749 134.8172 139.55751 142.61931 147.05902 151.86143 156.54054 158.75995 241.68054 247.37845 252.05756 256.73846 259.80026 264.29935 269.04144 273.72052 275.93991 360.06024 365.81845 370.43814 375.17844 378.24023 382.67993 387.48233 392.10202 394.32141 477.30142 483.05963 487.67932 492.41962 495.48141 499.92111 504.72351 509.3432 511.56259">Op/EnOperand 1Operand 2Operand 3Operand 4</tspan><tspan y="-566.99902" x="61.679588 66.658386 138.47659 144.35719 255.7169 261.53812 374.09753 379.97815 491.33786 497.21848">ZONANANANA</tspan></text><clipPath><path transform="matrix(1,0,0,-1,0,792)" d="m 45.12,108.24 h 512.7 V 96.84 H 45.12 Z" inkscape:connector-curvature="0" class="cC2A381AD" /></clipPath><g clip-path="url(#cp375)"><clipPath><path transform="matrix(1,0,0,-1,0,792)" d="M 0,792.03 H 612 V 0.0300293 H 0 Z" inkscape:connector-curvature="0" /></clipPath><g clip-path="url(#cp376)"><path transform="matrix(1,0,0,-1,45.12,685.98)" d="M 0,0 V 0.48" inkscape:connector-curvature="0" /><path transform="matrix(1,0,0,-1,0,792)" d="m 45.12,106.02 h 144.24 v 0.48001 H 45.12 Z" inkscape:connector-curvature="0" /></g></g><text xml:space="preserve" transform="translate(0,792)" font-size="9" class="c9256B18F cAF7646FE"><tspan y="-90.839996" x="45.119999 50.380501 59.561401 64.840805 69.521706 74.179207 78.647705 81.709503 86.388603 88.310104 93.021606 97.031105 101.0406 103.08 107.6412 111 113.0997 116.4702 121.2447 125.9562 127.9956 132.49471 136.9938 138.9153 143.6898 148.40131 150.44072 155.00192 158.36073 160.40015 165.82265 171.08315 176.34364 178.0797 180.1794 183.5706 188.3658 193.04669 195.14639 200.5464 205.2876 207.327 211.81619 216.55829 221.2365 223.27589 228.9711 235.5114 237.6111 240.91049 242.83199 247.32118 251.99939 255.9612 258.06091 262.50061 265.62271 270.30362 272.40332 276.84302 278.76453 285.72873 290.04782 294.74402 298.70584 300.80554 306.02554 308.12524 310.09445 314.83655 316.93625 322.33624 327.07745 331.51624 336.91623 342.20642 347.00162 349.04102 353.36011 356.7189 360.11011 364.84232 368.08411 370.18381 374.68472 379.18292 383.86383 387.76263 392.55783 395.94904 397.91824 402.59915 407.39435 409.43375 414.05435 417.35376 419.45346 424.07587 429.05737 433.79947 439.19946 443.94067 448.55948 450.28568 452.32507 454.43826 459.23346 461.27286 465.76205 470.38174 475.05994 476.98145 480.37265 482.34186 487.08307 491.82516 493.66837 495.70776 500.19696 502.13916 504.08136 506.12076 509.24286 513.92377 517.95398 522.63489 525.91809 530.33972 535.03595 539.71509 541.75446 546.43359 548.3551 551.71033 555.70453">1.Regardless of the value of R11, the RF and VM flags are always 0 in RFLAGS after execution of SYSRET. In addition, all reserved bits </tspan><tspan y="-79.859993" x="59.52002 61.466721 66.239418 68.458817 73.879517 78.598221 83.055923 88.515327 93.783028 98.555725 100.77512 103.89722 108.33782 111.75782 116.19752 118.14422 122.91692 125.13631 128.50502 133.27773 137.98743 140.20683 143.53954 145.48624 150.04384 154.72475 159.38045 161.59985 166.03865 170.53775 172.45744 177.23015 181.93985 185.94756">in RFLAGS retain the fixed values.</tspan></text><path transform="matrix(1,0,0,-1,0,792)" d="m 45.54,628.26 h 0.48001 v 65.46006 H 45.54 Z" inkscape:connector-curvature="0" /><path transform="matrix(1,0,0,-1,0,792)" d="m 144.48,627.72 h 0.47999 v 66.53997 H 144.48 Z" inkscape:connector-curvature="0" /><path transform="matrix(1,0,0,-1,0,792)" d="m 256.74,627.72 h 0.48 v 66.53997 h -0.48 z" inkscape:connector-curvature="0" /><path transform="matrix(1,0,0,-1,0,792)" d="M 281.52,627.72 H 282 v 66.53997 h -0.48 z" inkscape:connector-curvature="0" /><path transform="matrix(1,0,0,-1,0,792)" d="M 329.52,627.72 H 330 v 66.53997 h -0.48 z" inkscape:connector-curvature="0" /><path transform="matrix(1,0,0,-1,0,792)" d="m 376.26,627.72 h 0.48003 v 66.53997 H 376.26 Z" inkscape:connector-curvature="0" /><path transform="matrix(1,0,0,-1,0,792)" d="m 556.92,628.26 h 0.48 v 65.46006 h -0.48 z" inkscape:connector-curvature="0" /><path transform="matrix(1,0,0,-1,0,792)" d="M 45.48,693.78 H 557.4 v 0.4801 H 45.48 Z" inkscape:connector-curvature="0" /><path transform="matrix(1,0,0,-1,0,792)" d="M 45.48,668.76 H 557.4 v 0.48 H 45.48 Z" inkscape:connector-curvature="0" /><path transform="matrix(1,0,0,-1,0,792)" d="M 45.48,642.78 H 557.4 v 0.4801 H 45.48 Z" inkscape:connector-curvature="0" /><path transform="matrix(1,0,0,-1,0,792)" d="M 45.48,627.78 H 557.4 v 0.48 H 45.48 Z" inkscape:connector-curvature="0" /><path transform="matrix(1,0,0,-1,0,792)" d="m 46.38,562.26 h 0.47998 v 31.5 H 46.38 Z" inkscape:connector-curvature="0" /><path transform="matrix(1,0,0,-1,0,792)" d="m 87.18,561.72 h 0.48 v 32.52 h -0.48 z" inkscape:connector-curvature="0" /><path transform="matrix(1,0,0,-1,0,792)" d="m 200.76,561.72 h 0.48 v 32.52 h -0.48 z" inkscape:connector-curvature="0" /><path transform="matrix(1,0,0,-1,0,792)" d="m 321.6,561.72 h 0.48 v 32.52 h -0.48 z" inkscape:connector-curvature="0" /><path transform="matrix(1,0,0,-1,0,792)" d="m 437.58,561.72 h 0.48004 v 32.52 H 437.58 Z" inkscape:connector-curvature="0" /><path transform="matrix(1,0,0,-1,0,792)" d="m 556.08,562.26 h 0.48 v 31.5 h -0.48 z" inkscape:connector-curvature="0" /><path transform="matrix(1,0,0,-1,0,792)" d="m 46.32,593.76 h 510.24 v 0.48 H 46.32 Z" inkscape:connector-curvature="0" /><path transform="matrix(1,0,0,-1,0,792)" d="m 46.32,577.74 h 510.24 v 0.48 H 46.32 Z" inkscape:connector-curvature="0" /><path transform="matrix(1,0,0,-1,0,792)" d="m 46.32,561.78 h 510.24 v 0.48 H 46.32 Z" inkscape:connector-curvature="0" /></g></svg><br/><br/><svg xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape" version="1.1" width="504.46289pt" height="646.70911pt" viewBox="0 0 504.46289 646.70911" sodipodi:docname="1411.svg" inkscape:version="0.92.5 (2060ec1f9f, 2020-04-08)"><metadata><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage" /></cc:Work></rdf:RDF></metadata><defs /><sodipodi:namedview pagecolor="#ffffff" bordercolor="#666666" borderopacity="1" objecttolerance="10" gridtolerance="10" guidetolerance="10" inkscape:pageopacity="0" inkscape:pageshadow="2" inkscape:window-width="640" inkscape:window-height="480" showgrid="false" inkscape:zoom="0.22348485" inkscape:cx="346.02482" inkscape:cy="426.46305" inkscape:window-x="0" inkscape:window-y="0" inkscape:window-maximized="0" inkscape:current-layer="svg172" /><g transform="translate(-46.481384,-69.138184)" class="c9D877B2B"><text xml:space="preserve" transform="translate(0,792)" font-size="9" font-weight="bold" class="cC246365F c9256B18F c1AE6E0A5"><tspan y="-715.97998" x="46.02 48.482399 54.004799 58.984501 61.985104 65.497803 71.008499 75.988197 78.988792 81.502495 86.964592 92.475288 94.697388 100.20808 103.72079 109.23148 114.21118 117.72388 120.23759 125.69968 131.22209">Instruction ordering.</tspan></text><text xml:space="preserve" transform="translate(0,792)" font-size="9" class="c9256B18F cECB6486A"><tspan y="-715.97998" x="133.67999 136.56358 140.34358 146.03159 150.71158 154.24858 158.08258 163.77058 168.45059 171.98759 174.38429 179.84459 185.53259 190.21259 193.09618 196.25517 201.70917 204.16617 206.62317 212.07716 219.43016 221.88716 227.57516 233.17317 236.05676 241.45676 244.28094 250.42795 255.95395 262.10095 268.34695 274.02594 279.56094 282.44455 291.19254 296.53583 301.85483 304.67905 310.27704 315.63205 318.45627 321.61526 326.97028 330.57025 335.21967 340.86176 346.26447 351.86697 354.69119 357.85471 361.69321 367.1517 375.90421 378.72842 387.48093 392.84042 401.59293 407.05142 410.88992 416.21341 419.03763 424.64014 429.99963 433.16315 438.62164 442.46014 447.81964 450.64386 456.00336 461.40787 465.24637 467.70786 470.16934 475.52884 479.36734 482.19156 484.65305 490.34555 495.03006 498.57156 502.41006 508.10257 512.78705 516.32855 518.79004 524.24854 529.89062 534.57062"> Instructions following a SYSRET may be fetched from memory before earlier instructions </tspan><tspan y="-705" x="46.019958 50.694557 56.143158 64.885757 70.478355 72.929955 78.279556 81.811157 87.160759 90.044365 95.393967 100.61577 105.96537 110.63997 116.32257 119.85417 122.30577 127.75437 133.43697 136.73906 139.56325 145.20265 150.90416 154.43576 157.25995 160.79155 166.47415 171.82375 177.13734 179.96153 187.30913 189.76073 192.15742 194.61353 197.49712 203.17972 208.62831 212.15991 215.0435 220.3931 225.6149 230.96449 235.6391 241.3217 244.8533 250.2029 253.08649 257.15808 262.50769 267.72949 273.1322 278.81479 281.63901 286.3136 291.90619 297.3089 301.98889 307.67148 310.14026 315.54025 319.07724 321.53424 326.75604 332.15875 334.55545 339.87445 343.95145 346.83505 352.52304 358.21103 361.74802 364.20502 366.66202 369.48624 374.88623 377.34323 379.80023 382.62445 385.08145 390.76944 395.44943 398.98642 402.82043 408.50842 413.24872 416.78839 419.18509 424.64539 430.33337 435.01337 437.89697 443.49496 447.32898 449.78598 455.23999 459.02182 461.90543 465.44241 470.89642 473.72064 477.25763 482.94562 488.30063 491.18423 497.33124 502.85724 509.00424 515.25024 520.92926 526.46423 529.28845 534.97644 540.31976 545.54156 550.94427">complete execution, but they will not execute (even speculatively) until all instructions prior to the SYSRET have </tspan><tspan y="-694.02002" x="46.019958 50.699959 56.153961 64.901962 70.499962 72.956963 78.311966 81.848969 87.203972 92.801971 95.68557 101.04057 106.26237 111.61738 116.29738 121.98538 125.52238 127.97939 133.43338 139.12138 141.94559 146.02258 149.55959 155.24759 160.60258 163.48619 165.94319 171.34319 174.88019 180.23518 184.06918 186.89339 189.35039 195.03839 199.71838 203.25539 207.08939 212.77739 217.4574 220.9944 223.3911 228.85139 234.5394 239.21939 242.103 250.851 256.19431 261.51331 264.33749 269.7402 274.96201 280.31702 284.99701 290.685 294.22198 299.577 302.46057 308.05856 313.41357 316.57257 322.02658 325.8606 331.21561 334.03979 339.63779 345.03778 348.57477 353.97476 356.79895 361.47894 365.01593 370.46994 374.30396 379.70667 385.28665 388.11084 393.70883 399.02783 401.85202 405.452 411.09409 416.4968 419.32098 424.67599 430.07599 433.91 436.367 438.82401 444.17902 448.01303 450.89661 453.29242 458.9939 463.67389 467.21088 471.04489 476.73288 481.41287 484.94986 487.40686 492.86087 498.54886 503.28915 506.11334 511.80133 517.14465 522.36639 527.7088">completed execution (the later instructions may execute before data stored by the earlier instructions have </tspan><tspan y="-682.97974" x="46.019958 51.61076 56.958561 61.631363 67.078163 75.818962 81.166763 84.050362 89.641159 92.090958 97.537758 103.12856 108.52135 110.97115 113.42095 118.73275 121.61635 126.92815 129.37794 134.05075 136.50055 142.09135 144.54115 149.88895 153.95874">become globally visible).</tspan></text><text xml:space="preserve" transform="translate(0,792)" font-size="9.96" class="cC28FA1AE cD0BE81C2 c209E837B"><tspan y="-657.29999" x="46.02 52.630455 58.270802 63.845413 67.26767 72.573364 76.594215 79.08123 84.720589">Operation</tspan></text><text xml:space="preserve" transform="translate(0,792)" font-size="9" class="c9256B18F cAF7646FE"><tspan y="-640.97998" x="46.02 48.111599 52.7925 55.011902 57.598503 62.318104 67.091705 68.796303 73.254906">IF (CS.L </tspan></text><text xml:space="preserve" transform="translate(0,792)" font-size="10.98" class="c33EE2981 c8037F88D"><tspan y="-640.97998" x="75.480003">≠</tspan></text><text xml:space="preserve" transform="translate(0,792)" font-size="9.96" class="cC28FA1AE c8037F88D"><tspan y="-640.97998" x="81.540001"> </tspan></text><text xml:space="preserve" transform="translate(0,792)" font-size="9" class="c9256B18F cAF7646FE"><tspan y="-640.97998" x="84.059998 89.279999 91.499405 94.101303 96.320709 101.05561 104.33251 106.55192 109.15382 111.19502 116.81192 122.03192 127.30682 131.87073 136.55162 141.28651 146.02141 151.45831 153.17821 157.65211 164.19241 169.83182">1 ) or (IA32_EFER.LMA </tspan></text><text xml:space="preserve" transform="translate(0,792)" font-size="10.98" class="c33EE2981 c8037F88D"><tspan y="-640.97998" x="172.02">≠</tspan></text><text xml:space="preserve" transform="translate(0,792)" font-size="9" class="c9256B18F cAF7646FE"><tspan y="-640.97998" x="178.02 180.2394 185.5125 188.11259 190.33199 195.06508 198.34018 200.55957 203.15967 205.26477 210.87987 216.15297 221.42607 225.92697 230.66006 235.39316 240.07405 245.50916 247.18945 251.97655 256.65747 261.39056"> 1) or (IA32_EFER.SCE </tspan></text><text xml:space="preserve" transform="translate(0,792)" font-size="10.98" class="c33EE2981 c8037F88D"><tspan y="-640.97998" x="263.57999">≠</tspan></text><text xml:space="preserve" transform="translate(0,792)" font-size="9" class="c9256B18F cAF7646FE"><tspan y="-640.97998" x="269.64001 271.85941 277.13339"> 1)</tspan><tspan y="-630" x="46.019714 48.604515 52.620316 54.839718 60.682518 65.400314 68.768112 70.987511 72.933311 77.705109 79.924507 85.182304 90.440102 93.320999 98.602196 100.548 103.91579 106.13519 112.70699 117.42479 122.07959 126.78839 129.0078 133.7256 136.9854 139.2048 143.97661 149.09941 153.87122 158.58902 164.18881 168.64561 173.10242 176.22002 181.00441 186.13982 190.92421 196.35661 201.08701 206.27641 208.4958 213.2379 217.9791 221.3595 223.57889 228.30029 233.04239 237.52078 242.14049 244.07188 248.79329 253.41299 255.63239 257.59079 262.37518 264.59457 266.63577 272.27518 277.49515 282.77542 287.33481 292.01572 296.74612 301.47653 306.90894 309.12833 313.15674">(* Not in 64-Bit Mode or SYSCALL/SYSRET not enabled in IA32_EFER *)</tspan><tspan y="-618.00031" x="59.519722 64.70192 70.550117 75.273315 81.121513 83.340912 89.108109 94.794312 100.32751 102.19772 104.41711 109.14031 111.23551">THEN #UD; FI;</tspan><tspan y="-606.00061" x="46.019722 48.120323 52.801224 55.020626 57.616226 62.344826 67.469429 71.937027">IF (CPL </tspan></text><text xml:space="preserve" transform="translate(0,792)" font-size="10.98" class="c33EE2981 c8037F88D"><tspan y="-606" x="74.160004">≠</tspan></text><text xml:space="preserve" transform="translate(0,792)" font-size="9.96" class="cC28FA1AE cAF7646FE"><tspan y="-606" x="80.160004"> </tspan></text><text xml:space="preserve" transform="translate(0,792)" font-size="9" class="c9256B18F cAF7646FE"><tspan y="-606" x="82.620003 87.883202 90.473404 92.692802 97.875 103.7232 108.4041 114.2847 116.5041 122.2713 127.5435 132.6627 135.2529 140.5161 143.10629 144.97649 147.19589 151.9191 153.9603">0) THEN #GP(0); FI;</tspan><tspan y="-586.02002" x="46.019703 48.120304 52.801205 55.020607 57.616207 62.344807 67.010406 71.730011 75.00061 79.477211 84.259811 88.879517 91.098915 95.116516 97.020004 101.2113 105.8922 108.1116 110.08891 114.1272 116.3466 121.5666 126.8469 129.66751 134.3466 136.2681 139.62781 142.24411">IF (operand size is 64-bit) </tspan><tspan y="-574.02032" x="59.519707 64.7379 70.559105 75.278702 81.123306 83.342705 85.929306 89.946907 92.166306 97.587906 102.29851 105.66811 110.4417 113.7033 118.4769 120.6963 124.0659 128.78549 131.0049 136.2645 141.52409 144.3537 149.6673 151.6149 154.9845 157.2039 163.7775 168.4971 173.1537 177.8643 180.08371 184.1013">THEN (* Return to 64-Bit Mode *)</tspan><tspan y="-562.02063" x="77.519707 79.612206 84.332703 86.552101 89.139603 94.562103 99.2826 104.9391 107.1585 109.107 113.1165 115.3359 120.1104 124.83089 128.2014 130.42081 134.32231 138.79082 143.56532 148.28583 153.06033 155.00883 158.91034 163.37885 165.30034 167.88783 170.10724 175.28674 181.13225 185.85275 191.69826 193.91766 199.68216 204.95166 210.06816 212.65565 217.91615 220.50365">IF (RCX is not canonical) THEN #GP(0);</tspan><tspan y="-550.02094" x="77.519707 82.971909 85.094109 90.195312 92.414711 94.156212 99.257416 101.47681 106.92902 111.60992 117.29612">RIP := RCX;</tspan><tspan y="-538.02124" x="59.519707 64.241104 68.701508 73.476906 78.198303 80.417702 83.006104 87.025505 89.244904 94.668304 99.380707 102.8007 107.5428 110.8062 115.5816 117.80099 121.17239 125.89379 128.0997 132.8382 137.51909 144.48059 149.1003 153.58679 156.9753 158.9418 163.56151 165.52802 167.46751 169.38902 172.74873 177.44223 179.66162 186.25412 190.93501 195.61052 200.34003 202.55942 206.52121">ELSE (* Return to Compatibility Mode *)</tspan><tspan y="-525.96124" x="77.519699 82.944 85.0383 90.156601 92.375999 94.128296 99.246597 101.466 106.18829 110.91059 116.56889">RIP := ECX;</tspan><tspan y="-513.96155" x="46.019699 50.7006 52.801197">FI;</tspan><tspan y="-501.96185" x="46.019699 51.453899 56.1861 60.657299 66.2715 71.552704 76.338905 78.558304 80.320503 85.4487 87.668098 90.267296 95.701492 100.92149 106.2018 108.4212 114.3774 116.59679 121.869 126.5499 131.8221 136.50299 142.0452 147.2652 153.12241 155.7216 157.94099 159.8625 162.08189 167.3541 221.65379 224.25299 228.28319 230.50258 235.18347 237.10497 241.82817 246.26787 249.54207 251.76146 257.19565 261.92786 263.76205 265.98145 271.66763 278.20795 280.04214 282.26154 285.53574 290.21664 294.23785 298.96106 302.23526 306.88647 311.60968 316.22937 318.44876 323.11795 325.03946 328.42166 332.38348 334.2627 336.48209 340.44391 345.1842 348.56641 350.7858 355.45499 357.3765 360.7587 362.97809 368.25027 370.46967 374.49988">RFLAGS := (R11 &amp; 3C7FD7H) | 2;(* Clear RF, VM, reserved bits; set bit 1 *)</tspan><tspan y="-481.98184" x="46.019699 48.1203 52.801201 55.020603 57.616203 62.344803 67.010406 71.730011 75.00061 79.477211 84.259811 88.879517 91.098915 95.116516 97.019997 101.2113 105.8922 108.1116 110.0889 114.1272 116.3466 121.5666 126.84689 129.6675 134.34659 136.26808 139.62779 142.24409">IF (operand size is 64-bit) </tspan><tspan y="-469.98215" x="59.519699 64.708199 70.562698 75.292198 81.146698 83.366096 88.095596 92.8377 94.5522 99.294304 104.0148 105.9453 110.6262 114.52589 117.9054 122.6349 125.90639 128.1861 129.9456 135.07111 137.21939 139.31999 144.89999 150.1803 155.4003 159.9615 164.7639 169.9209 175.5009 180.9603 183.7188 188.9568 194.23711 195.9651 201.24541 206.48341 209.21942 214.43762 219.65762 224.93793">THEN CS.Selector := IA32_STAR[63:48]+16;</tspan><tspan y="-457.98245" x="59.519691 64.248291 68.715889 73.498489 78.227089 80.446487 85.127388 89.929787 91.643387 96.425987 101.10689 103.02839 107.74799 111.65759 115.03619 119.76479 123.03539 125.25478 127.01338 132.13799 134.35738 136.45798 142.06857 147.28857 152.56888 157.12648 161.86859 167.0562 172.66679 178.0974 180.864 186.1326 191.3526 193.11121 198.33121 203.59981 206.36641">ELSE CS.Selector := IA32_STAR[63:48];</tspan><tspan y="-445.98276" x="46.019691 50.700592 52.801189">FI;</tspan><tspan y="-433.98306" x="46.019691 50.728493 55.530895 57.224697 62.027096 66.726898 68.707794 73.407593 77.297394 80.656197 85.364998 88.615799 90.835205 92.574005 97.735504 99.95491 104.66371 109.46611 111.15991 115.96231 120.66211 122.57191 127.3122 131.2119 134.57069 139.2795 142.53029 144.74969 150.50789 155.90788 158.12729 163.37608 221.69609 224.2719 228.2787 230.49811 235.90891 241.0137 245.4615 247.68091 251.00371 255.71251 258.96332 262.85312 267.59341 272.21313 274.43253 277.79132 282.50012 284.71951 289.96832 292.18771 296.19452">CS.Selector := CS.Selector OR 3;(* RPL forced to 3 *)</tspan><tspan y="-421.98337" x="46.019691 48.605392 52.622093 54.841496 59.614197 64.323898 67.692596 69.911995 73.172691 77.882393 81.890091 85.258789 87.478188 92.196884 95.529587 97.748985 102.46768 107.24038 109.45978 112.87978 117.56068 119.78008 124.24677 126.46617 129.79887 131.74557 136.48318 141.22348 145.87918 148.09859 152.73628 157.20299 159.12268 163.89539 168.60509 170.82449 174.84119">(* Set rest of CS to a fixed value *)</tspan><tspan y="-409.98367" x="46.019691 50.725792 55.528194 57.219296 62.560795 67.014893 71.036995 75.77729 77.996689 79.732788 84.834885 87.054283 92.334587 221.63489 224.20799 228.2121 230.4315 235.1376 237.04471 241.54381 244.9035 247.12291 251.145 255.8259 260.505 267.4053 272.14563 276.94803 280.30414 282.52353 286.52762">CS.Base := 0;(* Flat segment *)</tspan><tspan y="-397.98398" x="46.019691 50.700592 55.502995 57.183296 61.682396 63.603897 70.564499 72.486 75.906006 78.125404 79.887604 84.9888 87.208199 91.940399 96.6213 101.3535 106.0857 110.7666 116.6238 221.56381 224.16301 228.19321 230.4126 237.6729 239.65471 243.03691 247.77901 249.9984 255.2706 258.11279 263.37601 268.6572 273.34439 276.72659 281.4498 283.66919 288.28888 291.59097 296.03067 300.83307 305.57516 307.49667 311.97687 315.21866 317.17886 320.56107 325.24826 327.04736 329.26675 331.22696 338.12726 342.79645 344.72964 346.68985 351.37076 355.39197 357.61136 362.05106 364.27045 369.54263 372.38483 377.66602 382.9472 387.6344 391.0166 395.73981 397.9592 399.8924 401.8526 408.7529 410.73471 414.11691 416.3363 420.36652">CS.Limit := FFFFFH;(* With 4-KByte granularity, implies a 4-GByte limit *)</tspan><tspan y="-385.98428" x="46.019691 50.700592 55.502995 57.183296 62.401497 67.088699 71.708397 76.431595 78.650993 80.413193 85.541389 87.760788 93.03299 98.252991 221.6133 224.19269 228.22289 230.44228 235.12317 239.92107 244.60197 248.50166 253.28786 256.67004 261.39325 264.53244 267.77423 272.51453 276.95422 281.6333 283.85269 287.7659 292.44681 297.116 301.79691 303.6311 305.85049 310.29019 314.189 318.1022 322.82541 326.84662 330.80844 335.53165 340.20084 342.42023 346.38205">CS.Type := 11;(* Execute/read code, accessed *)</tspan><tspan y="-373.98459" x="46.019691 50.721291 55.523689 57.210289 62.012688 64.232086 65.963684 71.061287 73.280685 78.560982">CS.S := 1;</tspan><tspan y="-361.98489" x="46.019691 50.71859 55.520988 57.204887 62.783089 67.877991 72.315887 74.535286 76.264183 81.425682 83.645081 88.88398">CS.DPL := 3;</tspan><tspan y="-349.9852" x="46.019691 50.721291 55.523689 57.210289 62.371788 64.591187 66.322784 71.420387 73.639786 78.920082">CS.P := 1;</tspan><tspan y="-337.9855" x="46.019691 48.120293 52.801193 55.020596 57.616196 62.344795 67.010399 71.729996 75.000595 79.477196 84.259796 88.879501 91.0989 95.116501 97.019989 101.21129 105.89219 108.11159 110.08889 114.12719 116.34659 121.56659 126.84689 129.6675 134.34659 136.26808 139.62779 142.24409">IF (operand size is 64-bit) </tspan><tspan y="-325.98581" x="59.519691 64.737885 70.55909 75.278687 81.123291 83.34269 85.929291 89.946892 92.16629 97.587891 102.29849 105.66809 110.44169 113.70329 118.47688 120.69628 124.06588 128.78548 131.00488 136.26448 141.52408 144.35368 149.66728 151.61488 154.98448 157.20389 163.77748 168.49709 173.15369 177.86429 180.08369 184.10129">THEN (* Return to 64-Bit Mode *)</tspan><tspan y="-313.98611" x="77.519691 82.236595 87.007492 88.709389 93.165291 95.384689 97.186493 102.28769 104.50709 109.76399 221.60428 224.18817 228.20306 230.42247 235.67937 240.93626 243.76317 248.41707 250.36197 253.72887 255.94827 259.84616 264.56305 269.21695 273.92484 276.14423 280.15012 284.858 289.5119 296.45181 301.1597 305.9306 309.29752 311.51691 315.5318">CS.L := 1;(* 64-bit code segment *)</tspan><tspan y="-301.98642" x="77.519691 82.235695 87.005692 88.706688 94.232689 96.452087 98.19809 103.31009 105.52949 110.78549 221.54581 224.12881 228.14282 230.36223 235.78023 240.48723 245.14023 249.91023 251.85423 255.11938 259.82819 264.48297 266.70236 268.64816 271.97995 274.19934 278.91714 283.68893 285.39172 289.84851 292.0679 297.1817 299.40109 304.65891 306.8783 310.8941">CS.D := 0;(* Required if CS.L = 1 *)</tspan><tspan y="-289.98672" x="59.519684 64.241081 68.701485 73.476883 78.19828 80.417679 83.006081 87.025482 89.244881 94.668282 99.380684 102.80068 107.54278 110.80618 115.58157 117.80097 121.17237 125.89377 128.09969 132.83818 137.51907 144.48058 149.10028 153.58678 156.97528 158.94179 163.56149 165.528 167.4675 169.38901 172.74872 177.44221 179.66161 186.2541 190.935 195.6105 200.34001 202.5594 206.52119">ELSE (* Return to Compatibility Mode *)</tspan><tspan y="-277.98703" x="77.519684 82.260887 87.063286 88.755287 93.201286 95.420685 97.222481 102.32368 104.54308 109.79008 221.63039 224.20439 228.2094 230.4288 235.1358 239.877 246.80701 251.451 255.9501 259.30978 261.24478 265.92389 267.85889 269.76688 271.74869 275.10837 279.77036 281.98975 288.91974 293.62674 298.30585 302.98676 305.20615 309.21115">CS.L := 0;(* Compatibility mode *)</tspan><tspan y="-265.98734" x="77.519684 82.260887 87.063286 88.752586 94.266884 96.486282 98.220581 103.38208 105.60148 110.84578 221.60608 224.17738 228.17969 230.39909 235.64339 240.92368 243.73798 248.39998 250.32149 253.68118 255.90057 259.81018 264.53879 269.20438 273.88528 276.10468 280.12228 284.80319 289.46878 296.42038 301.10129 305.90369 309.28229 311.50168 315.52829">CS.D := 1;(* 32-bit code segment *)</tspan><tspan y="-253.98764" x="46.019684 50.700584 52.801182">FI;</tspan><tspan y="-241.98795" x="46.019684 50.723083 55.525482 57.213882 62.494183 64.713577 66.446976 71.608482 73.827881 79.071281 221.63129 224.20169 228.20309 230.4225 235.66589 238.47929 243.7596 249.04079 253.69919 257.11917 261.81357 264.03296 268.71207 271.95386 276.40524 281.20767 285.96509 287.94598 292.39737 295.64276 297.62457 300.98425 305.64264 307.86203 311.86343">CS.G := 1;(* 4-KByte granularity *)</tspan><tspan y="-229.98825" x="46.019684 50.719482 55.880985 60.319786 62.539185 64.268982 69.364784 71.584183 76.864479">CPL := 3;</tspan><tspan y="-217.98856" x="46.019684 48.130184 52.811085 55.030483 59.822983 64.565086 69.05159 73.671288 78.40979 85.371292 90.113396 93.473099 97.959602 101.8791 106.1388 110.88 115.62211 120.12122 124.74091 126.72181 131.40271 136.08182 138.68732 143.36821 148.50272 152.94151">IF ShadowStackEnabled(CPL)</tspan><tspan y="-205.98886" x="59.519684 64.322083 69.064178 74.20858 76.427979 78.169472 83.270676 85.490074 87.610474 93.190475 98.478874 103.76727 108.26817 113.41257 117.85138 123.13978 127.64068 132.44308 137.18518 142.32957">SSP := IA32_PL3_SSP;</tspan><tspan y="-193.98917" x="46.019684 50.700584 52.801182">FI;</tspan><tspan y="-174.00917" x="46.019684 50.761784 55.564182 57.272381 62.04958 66.730476 68.651978 73.36618 77.270378 80.643578 85.366776 88.631973 90.851372 92.604568 97.72377 99.943169 102.53337 104.62857 110.23377 115.49697 120.71697 125.27818 130.05537 135.23758 140.84277 146.26797 149.02917 154.29237 159.55557 161.30878 166.57198 171.79198 174.55318 179.72638 184.98958 187.57977 189.79918 195.53038 200.95558 203.17499 208.39499 221.59528 224.18547 228.20667 230.42607 235.85127 240.97047 245.43268 247.65208 250.98929 255.71249 258.97769 262.8819 267.5961 272.21579 274.43518 277.80838 282.53159 284.75098 290.01419 292.23358 296.25479">SS.Selector := (IA32_STAR[63:48]+8) OR 3;(* RPL forced to 3 *)</tspan><tspan y="-162.00948" x="46.019684 48.605385 52.622086 54.841488 59.614189 64.323891 67.692589 69.911987 73.172684 77.882385 81.890083 85.258781 87.47818 92.196884 95.529587 97.748985 102.52168 107.29438 109.51378 112.88248 117.60118 119.82058 124.28728 126.50668 129.83937 131.78607 136.52368 141.26398 145.91968 148.13908 152.77678 157.24348 159.16318 163.93588 168.64558 170.86499 174.88168">(* Set rest of SS to a fixed value *)</tspan><tspan y="-150.00978" x="46.019684 50.761784 55.564186 57.244488 62.585991 67.025688 71.047791 75.768288 77.987686 79.747185 84.872688 87.092087 92.361588 221.60159 224.19809 228.22559 230.44498 235.12589 237.04738 241.52487 244.90437 247.12376 251.14226 255.82317 260.48965 267.38998 272.11047 276.89398 280.27347 282.49289 286.52039">SS.Base := 0;(* Flat segment *)</tspan><tspan y="-138.01009" x="46.019684 50.761784 55.564186 57.244488 61.743591 63.665092 70.625694 72.547188 75.906891 78.126289 79.886688 85.013092 87.232491 91.962891 96.643791 101.37419 106.05509 110.78549 116.64089 221.5809 224.16029 228.18869 230.40808 237.66838 239.65019 243.03059 247.77269 249.99208 255.26248 258.10287 263.36429 268.64548 273.33087 276.71127 281.43268 283.65207 288.27176 291.53967 295.97937 300.78177 305.52386 307.44537 311.92648 315.16827 317.12936 320.51245 325.20056 326.99966 329.21909 331.18018 338.08047 342.75058 344.68469 346.64578 351.32666 355.34875 357.56818 362.00787 364.22729 369.5004 372.34351 377.62561 382.9068 387.59491 390.978 395.70209 397.92151 399.85562 401.81671 408.71701 410.69879 414.08188 416.3013 420.3324">SS.Limit := FFFFFH;(* With 4-KByte granularity, implies a 4-GByte limit *)</tspan><tspan y="-126.01038" x="46.019669 50.777969 55.580372 57.269672 62.487873 67.147171 71.788467 76.528763 78.748161 80.48246 85.582764 87.802162 93.082466 221.60248 224.17378 228.17609 230.39549 235.80179 240.49709 244.99619 249.61588 252.79468 259.67969 262.98178 264.90329 268.27289 272.98349 275.20288 279.85947 284.32706 287.69666 292.16425 294.02274 296.24213 300.70972 304.61032 308.51093 313.22153 317.23013 321.23874 325.94934 330.60593 332.82532 336.78714">SS.Type := 3;(* Read/write data, accessed *)</tspan><tspan y="-114.01068" x="46.019684 50.777084 55.579483 57.267883 62.070282 64.28968 66.023079 71.122482 73.341881 78.622185">SS.S := 1;</tspan><tspan y="-102.01098" x="46.019684 50.778885 55.581287 57.271488 62.78669 67.948196 72.386993 74.606392 76.341591 81.442795 83.662193 88.942497">SS.DPL := 3;</tspan><tspan y="-90.011276" x="46.019684 50.777084 55.579483 57.267883 62.429382 64.648781 66.382179 71.481583 73.700981 78.981285">SS.P := 1;</tspan><tspan y="-78.011574" x="46.019684 50.793285 55.566887 57.271488 62.585091 64.804489 66.554092 71.669693 73.889091 79.148689 221.58899 224.17558 228.19318 230.41258 235.67218 240.93178 243.76138 248.41798 250.36559 253.73518 255.95459 259.9632 263.33279 267.80038 271.70099 275.97958 278.19897 282.20758 286.91818 291.57477 298.51736 303.22797 308.00156 311.37115 315.38876">SS.B := 1;(* 32-bit stack segment*)</tspan></text></g></svg><br/><br/><svg xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape" version="1.1" width="422.66708pt" height="290.9538pt" viewBox="0 0 422.66708 290.9538" sodipodi:docname="1412.svg" inkscape:version="0.92.5 (2060ec1f9f, 2020-04-08)"><metadata><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage" /></cc:Work></rdf:RDF></metadata><defs /><sodipodi:namedview pagecolor="#ffffff" bordercolor="#666666" borderopacity="1" objecttolerance="10" gridtolerance="10" guidetolerance="10" inkscape:pageopacity="0" inkscape:pageshadow="2" inkscape:window-width="640" inkscape:window-height="480" showgrid="false" inkscape:zoom="0.22348485" inkscape:cx="347.68766" inkscape:cy="-47.818766" inkscape:window-x="0" inkscape:window-y="0" inkscape:window-maximized="0" inkscape:current-layer="svg90" /><g transform="translate(-45.234257,-69.182129)" class="c9D877B2B"><text xml:space="preserve" transform="translate(0,792)" font-size="9" class="c9256B18F cAF7646FE"><tspan y="-715.97998" x="45.119999 49.8801 54.682503 56.373604 61.653904 63.873306 65.609406 70.770905 72.990303 78.236404 220.73611 223.30922 227.31332 229.53273 234.77882 237.59492 242.87523 248.15642 252.81752 256.23752 260.93463 263.15402 267.83313 271.07495 275.52905 280.33145 285.13385 287.05536 291.50946 294.75757 296.73938 300.09909 304.76019 306.97958 310.98367">SS.G := 1;(* 4-KByte granularity *)</tspan></text><text xml:space="preserve" transform="translate(0,792)" font-size="9.96" class="cC28FA1AE cD0BE81C2 c209E837B"><tspan y="-690.29999" x="45.119999 50.661743 53.175648 58.488312 64.128654 68.88356 71.403435 77.462105 81.360443 85.079506 90.718857 95.264603 99.24263 104.82421">Flags Affected</tspan></text><text xml:space="preserve" transform="translate(0,792)" font-size="9" class="c9256B18F cECB6486A"><tspan y="-673.97998" x="45.119999 51.2607 53.711399 56.162098">All.</tspan></text><text xml:space="preserve" transform="translate(0,792)" font-size="9.96" class="cC28FA1AE cD0BE81C2 c209E837B"><tspan y="-648.29999" x="45.119999 51.181656 54.603912 60.003227 63.964321 69.569809 74.139458 78.100555 83.680145 89.305557 91.825439 99.52253 105.12802 110.75343 116.35892 118.8788 124.39764 129.68042 134.11958 139.69917 145.15926 149.12035 151.63823 157.24371 162.98865">Protected Mode Exceptions</tspan></text><text xml:space="preserve" transform="translate(0,792)" font-size="9" class="c9256B18F cECB6486A"><tspan y="-634.02002" x="45.119999 52.4748 59.055599 137.2404 142.7583 148.4481 153.8049 156.68851 162.83731 168.36511 174.51392 180.76172 186.44252 191.97932 194.80353 197.26233 202.95213 207.63393 211.17273 215.00853 220.69833 225.38013 228.91893 231.37773 236.83353 242.52333 245.40694 247.86574 252.54753 255.37173 261.06152 266.51733 270.05612 272.88031 276.71609 282.1188 286.8006 292.20151 297.8013 303.49109 305.88779 310.56418 315.92099 321.52078 324.34497 326.80377 332.49356 335.31775 340.91754 344.69934 350.15515 353.69394 359.09665 363.77664 367.31543 372.67224 378.27203 381.15561 389.9054 395.36121 400.961 406.31781">#UDThe SYSRET instruction is not recognized in protected mode.</tspan></text><text xml:space="preserve" transform="translate(0,792)" font-size="9.96" class="cC28FA1AE cD0BE81C2 c209E837B"><tspan y="-608.34003" x="45.119999 51.298187 56.877781 62.179489 64.682434 67.753105 74.140457 79.7808 85.421143 88.843399 94.48275 99.222717 104.02245 106.48256 114.14479 119.78414 125.37469 131.01404 133.47417 139.05276 144.33556 148.71497 154.35432 159.75464 163.7755 166.25853 171.89789 177.60796">Real-Address Mode Exceptions</tspan></text><text xml:space="preserve" transform="translate(0,792)" font-size="9" class="c9256B18F cECB6486A"><tspan y="-594" x="45.119999 52.4757 59.0574 137.24219 142.76009 148.45079 153.80849 156.69209 162.8418 168.3705 174.5202 180.76891 186.45061 191.98831 194.81252 197.27222 202.96292 207.64561 211.18532 215.02202 220.71272 225.39542 228.93512 231.39482 236.85152 242.49362 245.37723 247.83693 252.51962 255.34383 261.03452 266.49121 270.03091 272.85513 276.69183 282.09454 286.77725 292.17816 297.77887 303.46957 305.86627 310.54266 315.90036 321.50107 324.32529 326.78497 332.47568 335.2999 339.1366 344.49429 349.897 352.35669 356.3761 361.77969 367.3804 372.98111 376.81781 382.22052 386.90323 391.58594 394.41016 403.16086 408.61755 414.21826 419.57596">#UDThe SYSRET instruction is not recognized in real-address mode.</tspan></text><text xml:space="preserve" transform="translate(0,792)" font-size="9.96" class="cC28FA1AE cD0BE81C2 c209E837B"><tspan y="-568.32001" x="45.119999 51.591011 54.078022 57.700474 61.721329 67.435379 72.741074 75.248009 78.322662 84.445076 90.622269 96.744682 102.92188 105.382 113.04821 118.68757 124.2821 129.92146 132.38159 137.91637 143.19916 147.57857 153.21793 158.61824 162.6391 165.12611 170.76547 176.47952">Virtual-8086 Mode Exceptions</tspan></text><text xml:space="preserve" transform="translate(0,792)" font-size="9" class="c9256B18F cECB6486A"><tspan y="-553.97998" x="45.119999 52.473 59.052002 137.23682 142.75471 148.44272 153.79771 156.68132 162.82832 168.35432 174.50133 180.74733 186.42633 191.96133 194.78554 197.24254 202.93054 207.61053 211.14754 214.98154 220.66954 225.34955 228.88655 231.34355 236.79755 242.48555 245.36916 247.82616 252.50616 255.33037 261.01837 266.47238 270.00937 272.83356 276.66757 282.07028 286.75027 292.15118 297.74918 303.43716 305.83386 310.51025 315.86526 321.46326 324.28745 326.74445 332.43243 335.25662 340.57562 343.03262 346.86664 350.40363 356.09161 361.49161 363.94861 368.0256 373.7406 379.5033 385.21829 390.93329 393.81686 402.56485 408.01886 413.61685 418.97186">#UDThe SYSRET instruction is not recognized in virtual-8086 mode.</tspan></text><text xml:space="preserve" transform="translate(0,792)" font-size="9.96" class="cC28FA1AE cD0BE81C2 c209E837B"><tspan y="-528.29999" x="45.119999 50.603973 56.19751 64.480247 70.093704 75.41832 79.408295 81.868416 87.508766 90.014702 92.540558 95.000679 99.02153 104.55531 107.07519 114.76032 120.35386 125.96732 131.56085 134.08073 139.63443 144.91721 149.35637 154.93596 160.39603 164.35712 166.86305 172.45659 178.18956">Compatibility Mode Exceptions</tspan></text><text xml:space="preserve" transform="translate(0,792)" font-size="9" class="c9256B18F cECB6486A"><tspan y="-513.96002" x="45.119999 52.4748 59.055599 137.2404 142.7583 148.4481 153.8049 156.68851 162.83731 168.36511 174.51392 180.76172 186.44252 191.97932 194.80353 197.26233 202.95213 207.63393 211.17273 215.00853 220.69833 225.38013 228.91893 231.37773 236.83353 242.52333 245.40694 247.86574 252.54753 255.37173 261.06152 266.51733 270.05612 272.88031 276.71609 282.1188 286.8006 292.20151 297.8013 303.49109 305.88779 310.56418 315.92099 321.52078 324.34497 326.80377 332.49356 335.31775 339.99954 345.45535 354.20514 359.80493 365.20673 368.74551 371.20432 376.80411 379.26291 381.72171 384.18051 387.65991 392.98071 395.8049 404.55469 410.0105 415.61029 420.9671">#UDThe SYSRET instruction is not recognized in compatibility mode.</tspan></text><text xml:space="preserve" transform="translate(0,792)" font-size="9.96" class="cC28FA1AE cD0BE81C2 c209E837B"><tspan y="-488.34" x="45.119999 51.264324 57.408649 60.505215 66.818863 69.327789 73.320755 75.780876 83.469002 89.065529 94.681976 100.2785 102.73862 108.29531 113.57809 117.9575 123.59686 128.99718 133.01804 135.52696 141.12349 146.85945">64-Bit Mode Exceptions</tspan></text><text xml:space="preserve" transform="translate(0,792)" font-size="9" class="c9256B18F cECB6486A"><tspan y="-474" x="45.119999 52.464897 59.035797 137.2206 141.0015 144.15239 146.97658 150.74847 156.93237 162.63927 168.34616 174.10886 179.77975 184.93765 190.60855 196.84645 200.14854 206.27214 212.53705 218.20795 221.09154 228.43643 231.32002 237.02692">#UDIf IA32_EFER.SCE = 0.</tspan><tspan y="-459.95999" x="137.2197 140.99699 144.15329 146.97748 150.51178 156.19708 161.54938 164.43297 169.35597 176.43538 182.70567 188.93097 191.75516 197.39456 201.23666 206.58896 209.74525 212.19955 217.51585 220.39944 222.79614 227.47615 230.35974 236.04504 240.72235 246.07465 251.66995">If the LOCK prefix is used.</tspan><tspan y="-445.98029" x="45.119995 52.461296 59.415596 64.875 68.953796 74.657097 137.2359 141.0042 144.18839 147.01257 153.31078 158.71077 163.75436">#GP(0)If CPL </tspan></text><text xml:space="preserve" transform="translate(0,792)" font-size="10.98" class="c33EE2981 c8037F88D"><tspan y="-445.98001" x="166.56">≠</tspan></text><text xml:space="preserve" transform="translate(0,792)" font-size="9.0539" class="cDBDE3506 cC7C7E1F8"><tspan y="-445.98001" x="172.62"> </tspan></text><text xml:space="preserve" transform="translate(0,792)" font-size="9" class="c9256B18F cECB6486A"><tspan y="-445.98001" x="174.84 180.5424">0.</tspan><tspan y="-432.00031" x="137.22 141.0063 144.1716 146.9958 150.53911 156.23341 161.59471 164.47832 168.31862 173.67992 177.22322 182.91753 186.75783 192.45213 195.27634 197.73964 202.42593 205.25014 208.79344 214.25374 217.13734 222.85864 228.57994 232.66324 238.26753 240.66423 244.20753 247.09114 255.84544 261.30576 266.91006 272.27136 275.15497 280.56128 286.2034 291.80771 294.63193 300.88422 307.16351 313.32581 316.15002 320.83633 326.29663 331.99094 335.53424 340.94055 343.40384 349.04596 353.72598 356.60959 362.0159 364.84012 370.53442 375.99472 381.68903 385.77234 390.45865 395.86496 401.55927 407.01956 412.71387 415.11057 419.79688 425.20319 427.66647 430.55008 435.95639 441.5607 447.16501 451.00531 456.36661 461.05292 465.73923">If the return is to 64-bit mode and RCX contains a non-canonical address.</tspan></text></g></svg>     <hr />     <p class="not_instruction_page">         This <b>UNOFFICIAL</b> reference was generated from the official <a href="https://www.intel.com/content/www/us/en/developer/articles/technical/intel-sdm.html">Intel® 64 and IA-32 Architectures Software Developer’s Manual</a> by a dumb script.         There is no guarantee that some parts aren't mangled or broken and is distributed <b>WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE</b>.     </p> </body>  </html>
